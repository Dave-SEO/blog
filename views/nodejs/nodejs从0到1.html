<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodejs ä» 0 åˆ° 1 | BeliefÂ°</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="https://infinitypro-img.infinitynewtab.com/custom-icon/8001de1jd3n68lbfnxxt564xvb0vl5.png?imageMogr2/thumbnail/240x/format/webp/blur/1x0/quality/100|imageslim">
    <script language="javascript" type="text/javascript" src="https://cdn.staticfile.org/jquery/1.7.2/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/blog/js/MouseClickEffect.js"></script>
    <meta name="description" content="è¯»ä¸€åˆ‡å¥½ä¹¦ï¼Œå°±æ˜¯å’Œè®¸å¤šé«˜å°šçš„äººè°ˆè¯ã€‚">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/blog/assets/css/0.styles.552c1f07.css" as="style"><link rel="preload" href="/blog/assets/js/app.45508e95.js" as="script"><link rel="preload" href="/blog/assets/js/5.e2f1812c.js" as="script"><link rel="preload" href="/blog/assets/js/1.f0d29b0d.js" as="script"><link rel="preload" href="/blog/assets/js/2.c2276c40.js" as="script"><link rel="preload" href="/blog/assets/js/70.2b8dc1d3.js" as="script"><link rel="preload" href="/blog/assets/js/20.fc7d5e78.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.18431728.js"><link rel="prefetch" href="/blog/assets/js/11.2b895bcf.js"><link rel="prefetch" href="/blog/assets/js/12.6a5774a0.js"><link rel="prefetch" href="/blog/assets/js/13.219a019b.js"><link rel="prefetch" href="/blog/assets/js/14.b8f2d24f.js"><link rel="prefetch" href="/blog/assets/js/15.15d2e655.js"><link rel="prefetch" href="/blog/assets/js/16.eec32ac2.js"><link rel="prefetch" href="/blog/assets/js/17.723b0598.js"><link rel="prefetch" href="/blog/assets/js/18.77a80591.js"><link rel="prefetch" href="/blog/assets/js/19.0ac9ed1d.js"><link rel="prefetch" href="/blog/assets/js/21.3a337d1e.js"><link rel="prefetch" href="/blog/assets/js/22.41ba82bb.js"><link rel="prefetch" href="/blog/assets/js/23.e6bbd74c.js"><link rel="prefetch" href="/blog/assets/js/24.71094caf.js"><link rel="prefetch" href="/blog/assets/js/25.9b1b14d5.js"><link rel="prefetch" href="/blog/assets/js/26.22caa178.js"><link rel="prefetch" href="/blog/assets/js/27.1e2346ba.js"><link rel="prefetch" href="/blog/assets/js/28.da26bcf8.js"><link rel="prefetch" href="/blog/assets/js/29.3bc1e41a.js"><link rel="prefetch" href="/blog/assets/js/30.f061ce57.js"><link rel="prefetch" href="/blog/assets/js/31.8e089ac8.js"><link rel="prefetch" href="/blog/assets/js/32.286fc0a8.js"><link rel="prefetch" href="/blog/assets/js/33.a817b7a1.js"><link rel="prefetch" href="/blog/assets/js/34.4e6d639a.js"><link rel="prefetch" href="/blog/assets/js/35.f967afc9.js"><link rel="prefetch" href="/blog/assets/js/36.f8e14475.js"><link rel="prefetch" href="/blog/assets/js/37.c8631129.js"><link rel="prefetch" href="/blog/assets/js/38.0a7954af.js"><link rel="prefetch" href="/blog/assets/js/39.2a762ecf.js"><link rel="prefetch" href="/blog/assets/js/40.d15de278.js"><link rel="prefetch" href="/blog/assets/js/41.f822d218.js"><link rel="prefetch" href="/blog/assets/js/42.2f7216de.js"><link rel="prefetch" href="/blog/assets/js/43.5cc28333.js"><link rel="prefetch" href="/blog/assets/js/44.798f8e3c.js"><link rel="prefetch" href="/blog/assets/js/45.7ce7a7e8.js"><link rel="prefetch" href="/blog/assets/js/46.9752875e.js"><link rel="prefetch" href="/blog/assets/js/47.fa4ff9fc.js"><link rel="prefetch" href="/blog/assets/js/48.67cd96e1.js"><link rel="prefetch" href="/blog/assets/js/49.2b631f5f.js"><link rel="prefetch" href="/blog/assets/js/50.180bad22.js"><link rel="prefetch" href="/blog/assets/js/51.4d593f7a.js"><link rel="prefetch" href="/blog/assets/js/52.0eb3edc2.js"><link rel="prefetch" href="/blog/assets/js/53.2beadd29.js"><link rel="prefetch" href="/blog/assets/js/54.85abb66c.js"><link rel="prefetch" href="/blog/assets/js/55.b6982ed4.js"><link rel="prefetch" href="/blog/assets/js/56.0e26c79e.js"><link rel="prefetch" href="/blog/assets/js/57.53b7930c.js"><link rel="prefetch" href="/blog/assets/js/58.093a6666.js"><link rel="prefetch" href="/blog/assets/js/59.993dc1e3.js"><link rel="prefetch" href="/blog/assets/js/6.e4363e17.js"><link rel="prefetch" href="/blog/assets/js/60.dafd0518.js"><link rel="prefetch" href="/blog/assets/js/61.4a483fb5.js"><link rel="prefetch" href="/blog/assets/js/62.c884c2c0.js"><link rel="prefetch" href="/blog/assets/js/63.99d01771.js"><link rel="prefetch" href="/blog/assets/js/64.efde0690.js"><link rel="prefetch" href="/blog/assets/js/65.20ea70f5.js"><link rel="prefetch" href="/blog/assets/js/66.8c3c15ef.js"><link rel="prefetch" href="/blog/assets/js/67.54db728d.js"><link rel="prefetch" href="/blog/assets/js/68.0b4ae556.js"><link rel="prefetch" href="/blog/assets/js/69.b7b206e2.js"><link rel="prefetch" href="/blog/assets/js/7.f69b54fb.js"><link rel="prefetch" href="/blog/assets/js/71.18a0b221.js"><link rel="prefetch" href="/blog/assets/js/72.f0499312.js"><link rel="prefetch" href="/blog/assets/js/73.51ce0c59.js"><link rel="prefetch" href="/blog/assets/js/74.05e4346d.js"><link rel="prefetch" href="/blog/assets/js/75.69f6e7e4.js"><link rel="prefetch" href="/blog/assets/js/76.24717bcb.js"><link rel="prefetch" href="/blog/assets/js/77.f1e6ba34.js"><link rel="prefetch" href="/blog/assets/js/78.ada45a72.js"><link rel="prefetch" href="/blog/assets/js/79.2fab0c81.js"><link rel="prefetch" href="/blog/assets/js/8.1f3525fd.js"><link rel="prefetch" href="/blog/assets/js/80.4a1f57d1.js"><link rel="prefetch" href="/blog/assets/js/81.4c4a4c55.js"><link rel="prefetch" href="/blog/assets/js/82.056cb2c3.js"><link rel="prefetch" href="/blog/assets/js/9.544a9a3b.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.ebcbdedf.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.552c1f07.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-584a622c><div data-v-584a622c><div id="loader-wrapper" class="loading-wrapper" data-v-c01c9394 data-v-584a622c data-v-584a622c><div class="loader-main" data-v-c01c9394><div data-v-c01c9394></div><div data-v-c01c9394></div><div data-v-c01c9394></div><div data-v-c01c9394></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-73c95a87 data-v-584a622c data-v-584a622c><h3 class="title" style="display:none;" data-v-73c95a87 data-v-73c95a87>BeliefÂ°</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-73c95a87 data-v-73c95a87><input type="password" value="" data-v-73c95a87> <span data-v-73c95a87>Konck! Knock!</span> <button data-v-73c95a87>OK</button></label> <div class="footer" style="display:none;" data-v-73c95a87 data-v-73c95a87><span data-v-73c95a87><i class="iconfont reco-theme" data-v-73c95a87></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-73c95a87>vuePress-theme-reco</a></span> <span data-v-73c95a87><i class="iconfont reco-copyright" data-v-73c95a87></i> <a data-v-73c95a87><span data-v-73c95a87>zn</span>
          Â Â 
          <span data-v-73c95a87>2018 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-584a622c><header class="navbar" data-v-584a622c><div title="å¯¼èˆª" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">BeliefÂ°</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/docker/" class="nav-link"><i class="iconfont undefined"></i>
  docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/JavaScriptè®¾è®¡æ¨¡å¼/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScriptè®¾è®¡æ¨¡å¼
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/nodejs/" class="nav-link"><i class="iconfont undefined"></i>
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/HTML5/" class="nav-link"><i class="iconfont undefined"></i>
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/é¡¹ç›®åˆå§‹åŒ–åŠæ„å»º/" class="nav-link"><i class="iconfont undefined"></i>
  é¡¹ç›®åˆå§‹åŒ–åŠæ„å»º
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/httpåè®®/" class="nav-link"><i class="iconfont undefined"></i>
  httpåè®®
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/redux/" class="nav-link"><i class="iconfont undefined"></i>
  redux
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/h5 live/" class="nav-link"><i class="iconfont undefined"></i>
  h5 live
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/webrtc/" class="nav-link"><i class="iconfont undefined"></i>
  webrtc
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/å‰ç«¯é¢è¯•/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯é¢è¯•
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/mongoDB/" class="nav-link"><i class="iconfont undefined"></i>
  mongoDB
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/å‰ç«¯å·¥ç¨‹åŒ–/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯å·¥ç¨‹åŒ–
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/å°ç¨‹åº/" class="nav-link"><i class="iconfont undefined"></i>
  å°ç¨‹åº
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      å…¶å®ƒ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Common sitesğŸˆ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Stackoverflow
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Vue.js
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  BootCDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.linuxcool.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Linuxå‘½ä»¤å¤§å…¨
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´çº¿
</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link"><i class="iconfont reco-message"></i>
  å…³äºæˆ‘
</a></div> <a href="https://github.com/Dave-SEO/blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-584a622c></div> <aside class="sidebar" data-v-584a622c><div class="personal-info-wrapper" data-v-7e653f02><img src="/blog/vuepress/head-fish.jpg" alt="author-avatar" class="personal-img" data-v-7e653f02> <h3 class="name" data-v-7e653f02>
    zn
  </h3> <div class="num" data-v-7e653f02><div data-v-7e653f02><h3 data-v-7e653f02>51</h3> <h6 data-v-7e653f02>æ–‡ç« </h6></div> <div data-v-7e653f02><h3 data-v-7e653f02>31</h3> <h6 data-v-7e653f02>æ ‡ç­¾</h6></div></div> <hr data-v-7e653f02></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/docker/" class="nav-link"><i class="iconfont undefined"></i>
  docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/JavaScriptè®¾è®¡æ¨¡å¼/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScriptè®¾è®¡æ¨¡å¼
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/nodejs/" class="nav-link"><i class="iconfont undefined"></i>
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/HTML5/" class="nav-link"><i class="iconfont undefined"></i>
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/é¡¹ç›®åˆå§‹åŒ–åŠæ„å»º/" class="nav-link"><i class="iconfont undefined"></i>
  é¡¹ç›®åˆå§‹åŒ–åŠæ„å»º
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/httpåè®®/" class="nav-link"><i class="iconfont undefined"></i>
  httpåè®®
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/redux/" class="nav-link"><i class="iconfont undefined"></i>
  redux
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/h5 live/" class="nav-link"><i class="iconfont undefined"></i>
  h5 live
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/webrtc/" class="nav-link"><i class="iconfont undefined"></i>
  webrtc
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/å‰ç«¯é¢è¯•/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯é¢è¯•
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/mongoDB/" class="nav-link"><i class="iconfont undefined"></i>
  mongoDB
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/å‰ç«¯å·¥ç¨‹åŒ–/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯å·¥ç¨‹åŒ–
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/å°ç¨‹åº/" class="nav-link"><i class="iconfont undefined"></i>
  å°ç¨‹åº
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      å…¶å®ƒ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Common sitesğŸˆ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Stackoverflow
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Vue.js
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  BootCDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.linuxcool.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Linuxå‘½ä»¤å¤§å…¨
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´çº¿
</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link"><i class="iconfont reco-message"></i>
  å…³äºæˆ‘
</a></div> <a href="https://github.com/Dave-SEO/blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>nodejs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html" class="active sidebar-link">nodejs ä» 0 åˆ° 1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nodejs-åˆ°åº•æ˜¯ä»€ä¹ˆ" class="sidebar-link">nodejs åˆ°åº•æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è¦å®ç°ä»€ä¹ˆ-ç³»ç»Ÿæ¶æ„å›¾" class="sidebar-link">è¦å®ç°ä»€ä¹ˆ - ç³»ç»Ÿæ¶æ„å›¾</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#é¡¹ç›®ç›®å½•" class="sidebar-link">é¡¹ç›®ç›®å½•</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nodejsåˆ›å»ºæœåŠ¡å™¨" class="sidebar-link">nodejsåˆ›å»ºæœåŠ¡å™¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æœåŠ¡å™¨åˆ›å»º" class="sidebar-link">æœåŠ¡å™¨åˆ›å»º</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è·å–getè¯·æ±‚å‚æ•°" class="sidebar-link">è·å–GETè¯·æ±‚å‚æ•°</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è·å–postè¯·æ±‚åŠå‚æ•°" class="sidebar-link">è·å–POSTè¯·æ±‚åŠå‚æ•°</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å¤„ç†ä¸åŒçš„è¯·æ±‚æ–¹å¼" class="sidebar-link">å¤„ç†ä¸åŒçš„è¯·æ±‚æ–¹å¼</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å¤„ç†ä¸åŒæ•°æ®ç±»å‹" class="sidebar-link">å¤„ç†ä¸åŒæ•°æ®ç±»å‹</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#express" class="sidebar-link">express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#express-é€‚åˆåšä»€ä¹ˆ" class="sidebar-link">express é€‚åˆåšä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#åˆ›å»ºæœåŠ¡å™¨" class="sidebar-link">åˆ›å»ºæœåŠ¡å™¨</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#åˆ›å»ºè¯·æ±‚æ–¹å¼-ä»¥å¯¹æ•°æ®å¢ã€æ”¹ã€æŸ¥ä¸ºä¾‹" class="sidebar-link">åˆ›å»ºè¯·æ±‚æ–¹å¼(ä»¥å¯¹æ•°æ®å¢ã€æ”¹ã€æŸ¥ä¸ºä¾‹)</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æ•°æ®æŒä¹…åŒ–å­˜å‚¨mongodb" class="sidebar-link">æ•°æ®æŒä¹…åŒ–å­˜å‚¨MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#mongodb-æ˜¯ä»€ä¹ˆ" class="sidebar-link">MongoDB æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#mongodb-æœ‰å“ªäº›ç‰¹æ€§" class="sidebar-link">MongoDB æœ‰å“ªäº›ç‰¹æ€§</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#mongodb-ä½¿ç”¨åœºæ™¯" class="sidebar-link">MongoDB ä½¿ç”¨åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å®‰è£…mongodb" class="sidebar-link">å®‰è£…MongoDB</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å‘½ä»¤" class="sidebar-link">å‘½ä»¤</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#mongdbåŸºæœ¬å¢åˆ æ”¹æŸ¥æ“ä½œ" class="sidebar-link">MongDBåŸºæœ¬å¢åˆ æ”¹æŸ¥æ“ä½œ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä½¿ç”¨nodeé“¾æ¥mongodb" class="sidebar-link">ä½¿ç”¨Nodeé“¾æ¥MongoDB</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#express-ä¸­é—´ä»¶" class="sidebar-link">Express ä¸­é—´ä»¶</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#getä¼ å‚" class="sidebar-link">GETä¼ å‚</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#restful-api" class="sidebar-link">Restful API</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æ¥å£æ–‡æ¡£" class="sidebar-link">æ¥å£æ–‡æ¡£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æ¥å£è¯´æ˜" class="sidebar-link">æ¥å£è¯´æ˜</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ç”¨æˆ·æ³¨å†Œ" class="sidebar-link">ç”¨æˆ·æ³¨å†Œ</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è·¯ç”±æ¨¡å—" class="sidebar-link">è·¯ç”±æ¨¡å—</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æ•°æ®å¤„ç†æ¨¡å—-mongoose" class="sidebar-link">æ•°æ®å¤„ç†æ¨¡å—(mongoose)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å®‰è£…" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä½¿ç”¨" class="sidebar-link">ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è¡¨å•éªŒè¯" class="sidebar-link">è¡¨å•éªŒè¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å®‰è£…-2" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä½¿ç”¨-2" class="sidebar-link">ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ç”¨æˆ·æ³¨å†Œ-2" class="sidebar-link">ç”¨æˆ·æ³¨å†Œ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#jwt-è®¤è¯" class="sidebar-link">JWT è®¤è¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å®‰è£…-3" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä½¿ç”¨-3" class="sidebar-link">ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ç”¨æˆ·ç™»é™†" class="sidebar-link">ç”¨æˆ·ç™»é™†</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è·¯ç”±æƒé™è®¤è¯" class="sidebar-link">è·¯ç”±æƒé™è®¤è¯</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ç”¨æˆ·ä¿®æ”¹" class="sidebar-link">ç”¨æˆ·ä¿®æ”¹</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç†" class="sidebar-link">æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æ–‡ä»¶ä¸Šä¼ " class="sidebar-link">æ–‡ä»¶ä¸Šä¼ </a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è…¾è®¯äº‘è§†é¢‘ç‚¹æ’­æœåŠ¡-vod" class="sidebar-link">è…¾è®¯äº‘è§†é¢‘ç‚¹æ’­æœåŠ¡(VoD)</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è§†é¢‘åˆ—è¡¨åŠåˆ†é¡µå±•ç¤º" class="sidebar-link">è§†é¢‘åˆ—è¡¨åŠåˆ†é¡µå±•ç¤º</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è·å–è§†é¢‘è¯¦æƒ…" class="sidebar-link">è·å–è§†é¢‘è¯¦æƒ…</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#é¢‘é“è®¢é˜…ä¸å–æ¶ˆè®¢é˜…" class="sidebar-link">é¢‘é“è®¢é˜…ä¸å–æ¶ˆè®¢é˜…</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è·å–é¢‘é“ä¿¡æ¯" class="sidebar-link">è·å–é¢‘é“ä¿¡æ¯</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æœç´¢æŸç”¨æˆ·-å…³æ³¨è¿‡è°" class="sidebar-link">æœç´¢æŸç”¨æˆ· å…³æ³¨è¿‡è°</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#æŸ¥çœ‹è°å…³æ³¨è¿‡æˆ‘-æˆ‘çš„ç²‰ä¸åˆ—è¡¨" class="sidebar-link">æŸ¥çœ‹è°å…³æ³¨è¿‡æˆ‘ï¼ˆæˆ‘çš„ç²‰ä¸åˆ—è¡¨ï¼‰</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è§†é¢‘è¯„è®º" class="sidebar-link">è§†é¢‘è¯„è®º</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#åˆ é™¤è§†é¢‘è¯„è®º" class="sidebar-link">åˆ é™¤è§†é¢‘è¯„è®º</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è§†é¢‘è¯„è®ºåˆ—è¡¨" class="sidebar-link">è§†é¢‘è¯„è®ºåˆ—è¡¨</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è§†é¢‘æ˜¯å¦å–œæ¬¢" class="sidebar-link">è§†é¢‘æ˜¯å¦å–œæ¬¢</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#vim-å‘½ä»¤" class="sidebar-link">vim å‘½ä»¤</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-ç¼“å­˜" class="sidebar-link">Redis ç¼“å­˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å‘½ä»¤-2" class="sidebar-link">å‘½ä»¤</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#åœ°å€" class="sidebar-link">åœ°å€</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-cli-å®¢æˆ·ç«¯é“¾æ¥" class="sidebar-link">redis-cli å®¢æˆ·ç«¯é“¾æ¥</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-æ•°æ®åº“" class="sidebar-link">redis æ•°æ®åº“</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-æ•°æ®ç±»å‹" class="sidebar-link">redis æ•°æ®ç±»å‹</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-é”®å" class="sidebar-link">redis é”®å</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å“ˆå¸Œæ“ä½œæŒ‡ä»¤" class="sidebar-link">å“ˆå¸Œæ“ä½œæŒ‡ä»¤</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redisåˆ—è¡¨" class="sidebar-link">Redisåˆ—è¡¨</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-é›†åˆ" class="sidebar-link">Redis é›†åˆ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-æœ‰åºé›†åˆ" class="sidebar-link">Redis æœ‰åºé›†åˆ</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-å¯†ç " class="sidebar-link">Redis å¯†ç </a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#redis-config-é…ç½®" class="sidebar-link">Redis config é…ç½®</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä½¿ç”¨nodeæ“ä½œredis" class="sidebar-link">ä½¿ç”¨Nodeæ“ä½œRedis</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#çƒ­åº¦æ’åæ¡ˆä¾‹" class="sidebar-link">çƒ­åº¦æ’åæ¡ˆä¾‹</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ç›¸å…³åœ°å€" class="sidebar-link">ç›¸å…³åœ°å€</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è§†é¢‘æ”¶è—åŠŸèƒ½å®ç°" class="sidebar-link">è§†é¢‘æ”¶è—åŠŸèƒ½å®ç°</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å®ç°è§†é¢‘çƒ­é—¨æ¨èæœºåˆ¶" class="sidebar-link">å®ç°è§†é¢‘çƒ­é—¨æ¨èæœºåˆ¶</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#unbantu" class="sidebar-link">unbantu</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å®‰è£…node" class="sidebar-link">å®‰è£…node</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nginx-åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡" class="sidebar-link">nginx åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nginx-å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨" class="sidebar-link">nginx å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nginx-å·¥ä½œæ¨¡å‹" class="sidebar-link">nginx å·¥ä½œæ¨¡å‹</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nginx-å‘½ä»¤" class="sidebar-link">nginx å‘½ä»¤</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nginx-é…ç½®æ–‡ä»¶" class="sidebar-link">nginx é…ç½®æ–‡ä»¶</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#nginx-åå‘ä»£ç†" class="sidebar-link">nginx åå‘ä»£ç†</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#https-é…ç½®" class="sidebar-link">https é…ç½®</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#é¡¹ç›®å®Œæ•´åœ°å€" class="sidebar-link">é¡¹ç›®å®Œæ•´åœ°å€</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#è‡ªå®šä¹‰è„šæ‰‹æ¶çš„å®ç°" class="sidebar-link">è‡ªå®šä¹‰è„šæ‰‹æ¶çš„å®ç°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#åˆ›å»ºè‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤" class="sidebar-link">åˆ›å»ºè‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä½¿ç”¨commanderå¤„ç†helpé€‰é¡¹åŠè‡ªå®šä¹‰" class="sidebar-link">ä½¿ç”¨commanderå¤„ç†helpé€‰é¡¹åŠè‡ªå®šä¹‰</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å‘½ä»¤è¡Œé—®ç­”äº¤äº’-inquirer-js" class="sidebar-link">å‘½ä»¤è¡Œé—®ç­”äº¤äº’(inquirer.js)</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä¸‹è½½è¿œç¨‹ä»“åº“æ¨¡ç‰ˆä»£ç -download-git-repo" class="sidebar-link">ä¸‹è½½è¿œç¨‹ä»“åº“æ¨¡ç‰ˆä»£ç (download-git-repo)</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#ä¸‹è½½ç­‰å¾…æç¤ºäº¤äº’-ora" class="sidebar-link">ä¸‹è½½ç­‰å¾…æç¤ºäº¤äº’(ora)</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å‘½ä»¤è¡Œæ ·å¼æ¸²æŸ“å·¥å…·-chalk" class="sidebar-link">å‘½ä»¤è¡Œæ ·å¼æ¸²æŸ“å·¥å…·(chalk)</a></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#é¡¹ç›®åœ°å€" class="sidebar-link">é¡¹ç›®åœ°å€</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/views/nodejs/nodejsä»0åˆ°1.html#å°†è‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·å‘å¸ƒåˆ°npm" class="sidebar-link">å°†è‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·å‘å¸ƒåˆ°npm</a></li></ul></li><li><a href="/blog/views/nodejs/buffer.html" class="sidebar-link">Buffer</a></li><li><a href="/blog/views/nodejs/mongoDB.html" class="sidebar-link">mongoDBåœ¨nodeä¸­çš„ä½¿ç”¨</a></li><li><a href="/blog/views/nodejs/mongoDBé…ç½®.html" class="sidebar-link">mongoDBé…ç½®</a></li><li><a href="/blog/views/nodejs/nodejsExcelå¯¼å‡º.html" class="sidebar-link">nodejs excelå¯¼å‡º</a></li><li><a href="/blog/views/nodejs/nodemailer.html" class="sidebar-link">nodemailer+(node-schedule)+phantom å®ç°å®šæ—¶å‘é€é‚®ä»¶æˆªå›¾</a></li><li><a href="/blog/views/nodejs/_path.html" class="sidebar-link">path</a></li><li><a href="/blog/views/nodejs/socket.io.html" class="sidebar-link">socket.io</a></li><li><a href="/blog/views/nodejs/çˆ¬è™«.html" class="sidebar-link">çˆ¬è™«</a></li><li><a href="/blog/views/nodejs/httpcode.html" class="sidebar-link">http å¸¸è§çŠ¶æ€ç </a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>live</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpackOrCli</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>wechat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯é¢è¯•</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-73c95a87 data-v-584a622c><h3 class="title" style="display:none;" data-v-73c95a87 data-v-73c95a87>nodejs ä» 0 åˆ° 1</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-73c95a87 data-v-73c95a87><input type="password" value="" data-v-73c95a87> <span data-v-73c95a87>Konck! Knock!</span> <button data-v-73c95a87>OK</button></label> <div class="footer" style="display:none;" data-v-73c95a87 data-v-73c95a87><span data-v-73c95a87><i class="iconfont reco-theme" data-v-73c95a87></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-73c95a87>vuePress-theme-reco</a></span> <span data-v-73c95a87><i class="iconfont reco-copyright" data-v-73c95a87></i> <a data-v-73c95a87><span data-v-73c95a87>zn</span>
          Â Â 
          <span data-v-73c95a87>2018 - </span>
          2022
        </a></span></div></div> <div data-v-584a622c><main class="page"><!----> <div class="page-title" style="display:none;"><h1>nodejs ä» 0 åˆ° 1</h1> <hr> <div data-v-7b2e794a><i class="iconfont reco-account" data-v-7b2e794a><span data-v-7b2e794a>zn</span></i> <i class="iconfont reco-date" data-v-7b2e794a><span data-v-7b2e794a>2022-10-14 12:10:00</span></i> <i class="iconfont reco-eye" data-v-7b2e794a><span id="/blog/views/nodejs/nodejs%E4%BB%8E0%E5%88%B01.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-7b2e794a><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-7b2e794a><span class="tag-item" data-v-7b2e794a>
      nodejs
    </span><span class="tag-item" data-v-7b2e794a>
      express
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div id="boxx" data-v-1e44702b><div data-v-1e44702b><p v-if="true" class="custom-block-title" data-v-1e44702b></p> <p v-if="true" data-v-1e44702b></p></div></div> <h2 id="nodejs-åˆ°åº•æ˜¯ä»€ä¹ˆ"><a href="#nodejs-åˆ°åº•æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> nodejs åˆ°åº•æ˜¯ä»€ä¹ˆ</h2> <ul><li>nodejsä¸æ˜¯ä¸€ç§ç‹¬ç«‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿä¸æ˜¯javascriptæ¡†æ¶</li> <li>nodejsæ˜¯ä¸€ä¸ªåŸºäºchrome v8 å¼•æ“çš„javascriptè¿è¡Œç¯å¢ƒ</li></ul> <h2 id="è¦å®ç°ä»€ä¹ˆ-ç³»ç»Ÿæ¶æ„å›¾"><a href="#è¦å®ç°ä»€ä¹ˆ-ç³»ç»Ÿæ¶æ„å›¾" class="header-anchor">#</a> è¦å®ç°ä»€ä¹ˆ - ç³»ç»Ÿæ¶æ„å›¾</h2> <figure class="third"><img src="/blog/img/node/sys_server.png" width="600px"></figure> <h2 id="é¡¹ç›®ç›®å½•"><a href="#é¡¹ç›®ç›®å½•" class="header-anchor">#</a> é¡¹ç›®ç›®å½•</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">.</span>
â”œâ”€â”€ app<span class="token punctuation">.</span>js                      <span class="token comment">// å…¥å£æ–‡ä»¶</span>
â”œâ”€â”€ config                      <span class="token comment">// é…ç½®é¡¹</span>
â”‚   â””â”€â”€ config<span class="token punctuation">.</span>default<span class="token punctuation">.</span>js
â”œâ”€â”€ controller                  <span class="token comment">// ä¸šåŠ¡é€»è¾‘</span>
â”‚   â”œâ”€â”€ index<span class="token punctuation">.</span>js
â”‚   â”œâ”€â”€ userController<span class="token punctuation">.</span>js
â”‚   â”œâ”€â”€ videoController<span class="token punctuation">.</span>js
â”‚   â””â”€â”€ vodController<span class="token punctuation">.</span>js
â”œâ”€â”€ middleware                  <span class="token comment">// ä¸­é—´ä»¶</span>
â”‚   â””â”€â”€ validator               <span class="token comment">//  è¡¨å•éªŒè¯ </span>
â”‚       â”œâ”€â”€ errorBack<span class="token punctuation">.</span>js
â”‚       â”œâ”€â”€ userValidator<span class="token punctuation">.</span>js
â”‚       â””â”€â”€ videoValidator<span class="token punctuation">.</span>js   
â”œâ”€â”€ model                      <span class="token comment">// mongoos æ¨¡å‹</span>
â”‚   â”œâ”€â”€ baseModel<span class="token punctuation">.</span>js           <span class="token comment">// å…¬å…±æ¨¡å‹</span>
â”‚   â”œâ”€â”€ collectionModel<span class="token punctuation">.</span>js     <span class="token comment">// æ”¶è—</span>
â”‚   â”œâ”€â”€ commentModel<span class="token punctuation">.</span>js        <span class="token comment">// è¯„è®º</span>
â”‚   â”œâ”€â”€ index<span class="token punctuation">.</span>js               <span class="token comment">// mongoos é…ç½®</span>
â”‚   â”œâ”€â”€ redis                   <span class="token comment">// redis é…ç½®</span>
â”‚   â”‚   â”œâ”€â”€ index<span class="token punctuation">.</span>js
â”‚   â”‚   â””â”€â”€ redisVideoHots<span class="token punctuation">.</span>js   <span class="token comment">// redis å®ç°çƒ­é—¨æ¨è</span>
â”‚   â”œâ”€â”€ subscribeModel<span class="token punctuation">.</span>js       <span class="token comment">// è®¢é˜…æ¨¡å‹</span>
â”‚   â”œâ”€â”€ userModel<span class="token punctuation">.</span>js            <span class="token comment">// ç”¨æˆ·</span>
â”‚   â”œâ”€â”€ videoModel<span class="token punctuation">.</span>js           <span class="token comment">// è§†é¢‘</span>
â”‚   â””â”€â”€ videolikeModel<span class="token punctuation">.</span>js       <span class="token comment">// è§†é¢‘æ˜¯å¦å–œæ¬¢</span>
â”œâ”€â”€ router                      <span class="token comment">// express è·¯ç”±</span>
â”‚   â”œâ”€â”€ index<span class="token punctuation">.</span>js                <span class="token comment">// è·¯ç”±é…ç½®æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ user<span class="token punctuation">.</span>js                 <span class="token comment">// ç”¨æˆ·ç›¸å…³è·¯ç”±</span>
â”‚   â””â”€â”€ video<span class="token punctuation">.</span>js                <span class="token comment">// è§†é¢‘ç›¸å…³è·¯ç”±</span>
â””â”€â”€ utils                       
    â”œâ”€â”€ jwt<span class="token punctuation">.</span>js                  <span class="token comment">// jwt éªŒè¯</span>
    â””â”€â”€ md5<span class="token punctuation">.</span>js                  <span class="token comment">// md5 åŠ å¯†</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="nodejsåˆ›å»ºæœåŠ¡å™¨"><a href="#nodejsåˆ›å»ºæœåŠ¡å™¨" class="header-anchor">#</a> nodejsåˆ›å»ºæœåŠ¡å™¨</h2> <h3 id="æœåŠ¡å™¨åˆ›å»º"><a href="#æœåŠ¡å™¨åˆ›å»º" class="header-anchor">#</a> æœåŠ¡å™¨åˆ›å»º</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
   <span class="token comment">//1. è·å–æœåŠ¡å™¨å¯¹è±¡</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 2. ç›‘å¬ç«¯å£</span>
   server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8080'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token operator">...</span>
       res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="è·å–getè¯·æ±‚å‚æ•°"><a href="#è·å–getè¯·æ±‚å‚æ•°" class="header-anchor">#</a> è·å–GETè¯·æ±‚å‚æ•°</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// user?id=123&amp;name=dave</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
params<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="è·å–postè¯·æ±‚åŠå‚æ•°"><a href="#è·å–postè¯·æ±‚åŠå‚æ•°" class="header-anchor">#</a> è·å–POSTè¯·æ±‚åŠå‚æ•°</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
 <span class="token comment">// postæ•°æ®æ˜¯ä¸æ–­çš„å åŠ ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨è¯·æ±‚åˆ°çš„</span>
 server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token comment">//æ¥æ”¶æ•°æ®</span>
      req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       data <span class="token operator">+=</span> d
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// æ•°æ®æ¥æ”¶å®Œæˆ</span>
      req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="å¤„ç†ä¸åŒçš„è¯·æ±‚æ–¹å¼"><a href="#å¤„ç†ä¸åŒçš„è¯·æ±‚æ–¹å¼" class="header-anchor">#</a> å¤„ç†ä¸åŒçš„è¯·æ±‚æ–¹å¼</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token operator">...</span>
       res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token operator">...</span>
       res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="å¤„ç†ä¸åŒæ•°æ®ç±»å‹"><a href="#å¤„ç†ä¸åŒæ•°æ®ç±»å‹" class="header-anchor">#</a> å¤„ç†ä¸åŒæ•°æ®ç±»å‹</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/user'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="express"><a href="#express" class="header-anchor">#</a> express</h2> <h3 id="express-é€‚åˆåšä»€ä¹ˆ"><a href="#express-é€‚åˆåšä»€ä¹ˆ" class="header-anchor">#</a> express é€‚åˆåšä»€ä¹ˆ</h3> <ul><li>ä¼ ç»ŸWebç½‘ç«™</li> <li>API æ¥å£æœåŠ¡å™¨</li> <li>æœåŠ¡ç«¯æ¸²æŸ“ä¸­é—´å±‚</li> <li>è‡ªå®šä¹‰é›†æˆæ¡†æ¶</li> <li>å¼€å‘è¾…åŠ©å·¥å…·(webpack-dev-server...)</li></ul> <h3 id="åˆ›å»ºæœåŠ¡å™¨"><a href="#åˆ›å»ºæœåŠ¡å™¨" class="header-anchor">#</a> åˆ›å»ºæœåŠ¡å™¨</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'8081'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'liste http:127.0.0.1:8080'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="åˆ›å»ºè¯·æ±‚æ–¹å¼-ä»¥å¯¹æ•°æ®å¢ã€æ”¹ã€æŸ¥ä¸ºä¾‹"><a href="#åˆ›å»ºè¯·æ±‚æ–¹å¼-ä»¥å¯¹æ•°æ®å¢ã€æ”¹ã€æŸ¥ä¸ºä¾‹" class="header-anchor">#</a> åˆ›å»ºè¯·æ±‚æ–¹å¼(ä»¥å¯¹æ•°æ®å¢ã€æ”¹ã€æŸ¥ä¸ºä¾‹)</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">//data.json </span>
 <span class="token comment">// {&quot;users&quot;:[{&quot;id&quot;:1,&quot;username&quot;:&quot;dave&quot;,&quot;age&quot;:17}]}</span>
 
 <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
  <span class="token comment">// æ¥æ”¶è¡¨å•æ•°æ®</span>
 app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">// æ¥æ”¶jsonæ•°æ®</span>
 app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment">// æŠŠå›è°ƒå‡½æ•°å˜ä¸ºpromise</span>
 <span class="token keyword">const</span> readFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span>
 <span class="token keyword">const</span> writeFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>writeFile<span class="token punctuation">)</span>
 app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
 <span class="token comment">// å¢åŠ </span>
 app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> jsonObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> jsonObj<span class="token punctuation">.</span>users
  <span class="token keyword">const</span> id <span class="token operator">=</span> users<span class="token punctuation">[</span>users<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">const</span> addusers <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> <span class="token operator">...</span>req<span class="token punctuation">.</span>body<span class="token punctuation">}</span>
  jsonObj<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>addusers<span class="token punctuation">)</span>
 <span class="token comment">// å†™å…¥æ•°æ®</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">await</span> <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span><span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span>
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'å†™å…¥é”™è¯¯'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
 <span class="token comment">//ä¿®æ”¹</span>
 app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
    <span class="token keyword">const</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
   <span class="token keyword">try</span> <span class="token punctuation">{</span>
     <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
     <span class="token keyword">const</span> jsonObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
     <span class="token keyword">const</span> user <span class="token operator">=</span> jsonObj<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">ret</span> <span class="token operator">=&gt;</span> ret<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span><span class="token punctuation">{</span>
       res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token string">'ç”¨æˆ·ä¸å­˜åœ¨'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
     user<span class="token punctuation">.</span>username <span class="token operator">=</span> body<span class="token punctuation">.</span>username<span class="token operator">?</span>body<span class="token punctuation">.</span>username <span class="token operator">:</span> user<span class="token punctuation">.</span>username
     user<span class="token punctuation">.</span>age <span class="token operator">=</span> body<span class="token punctuation">.</span>age<span class="token operator">?</span>body<span class="token punctuation">.</span>age <span class="token operator">:</span> user<span class="token punctuation">.</span>age
     jsonObj<span class="token punctuation">.</span>users<span class="token punctuation">[</span>jsonObj<span class="token punctuation">.</span>users<span class="token punctuation">.</span>id <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> user

     <span class="token keyword">try</span> <span class="token punctuation">{</span>
       <span class="token keyword">await</span> <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span><span class="token punctuation">)</span>
       res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>

   <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h2 id="æ•°æ®æŒä¹…åŒ–å­˜å‚¨mongodb"><a href="#æ•°æ®æŒä¹…åŒ–å­˜å‚¨mongodb" class="header-anchor">#</a> æ•°æ®æŒä¹…åŒ–å­˜å‚¨MongoDB</h2> <h3 id="mongodb-æ˜¯ä»€ä¹ˆ"><a href="#mongodb-æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> MongoDB æ˜¯ä»€ä¹ˆ</h3> <ul><li>ä¸€ä¸ªåŸºäºæ–‡ä»¶å­˜å‚¨çš„åˆ†å¸ƒå¼ NoSQL(éå…³ç³»å‹æ•°æ®åº“) æ•°æ®åº“ç³»ç»Ÿ(æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜)</li> <li>æ•°æ®ç»“æ„ç”±é”®å€¼å¯¹(key,value)ç»„æˆ</li> <li>æ‹¥æœ‰éå¸¸å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›</li></ul> <h3 id="mongodb-æœ‰å“ªäº›ç‰¹æ€§"><a href="#mongodb-æœ‰å“ªäº›ç‰¹æ€§" class="header-anchor">#</a> MongoDB æœ‰å“ªäº›ç‰¹æ€§</h3> <ul><li>æ–‡æ¡£å‹æ•°æ®åº“ï¼Œè¾ƒå¼ºå¯æ‰©å±•æ€§ï¼Œæ‹¥æœ‰å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€ï¼Œå¤šç§å­˜å‚¨å¼•æ“</li> <li>é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œæ°´å¹³æ‰©å±•ï¼šæ”¯æŒæ•°æ®åµŒå…¥ï¼Œå­æ–‡æ¡£æŸ¥è¯¢ã€æ”¯æŒå‰¯æœ¬é›†ä¸åˆ†ç‰‡</li> <li>å¤šç§æŸ¥è¯¢ç±»å‹æ”¯æŒï¼Œä¸”æ”¯æŒæ•°æ®èšåˆæŸ¥è¯¢ã€æ–‡æœ¬æ£€ç´¢ã€åœ°å€ä½ç½®æŸ¥è¯¢</li></ul> <h3 id="mongodb-ä½¿ç”¨åœºæ™¯"><a href="#mongodb-ä½¿ç”¨åœºæ™¯" class="header-anchor">#</a> MongoDB ä½¿ç”¨åœºæ™¯</h3> <ul><li>å¯¹æ•°æ®å¤„ç†æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚</li> <li>éœ€è¦å€ŸåŠ©ç¼“å­˜å±‚æ¥å¤„ç†æ•°æ®</li> <li>éœ€è¦é«˜åº¦çš„ä¼¸ç¼©æ€§</li></ul> <h3 id="å®‰è£…mongodb"><a href="#å®‰è£…mongodb" class="header-anchor">#</a> å®‰è£…MongoDB</h3> <ol><li>å¥‡æ•°ç‰ˆæœ¬ä¸ºæµ‹è¯•ç‰ˆï¼Œå¶æ•°ä¸ºç¨³å®šç‰ˆ</li> <li>3.2ä¹‹åã€‚ä¸å†æ”¯æŒ32ä½æ“ä½œç³»ç»Ÿ</li> <li>https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-os-x/</li></ol> <h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="header-anchor">#</a> å‘½ä»¤</h3> <ol><li>show dbs æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›</li> <li>use xxx åˆ‡æ¢åˆ°æŸä¸ªæ•°æ®åº“</li> <li>db æŸ¥çœ‹å½“å‰åœ¨å“ªä¸ªæ•°æ®åº“</li> <li>show collections æ˜¾ç¤ºé›†åˆ</li> <li>db.xx.drop() &lt;xxå“ªä¸ªé›†åˆ&gt; åˆ é™¤æŸä¸ªé›†åˆ</li> <li>exit é€€å‡º</li></ol> <h3 id="mongdbåŸºæœ¬å¢åˆ æ”¹æŸ¥æ“ä½œ"><a href="#mongdbåŸºæœ¬å¢åˆ æ”¹æŸ¥æ“ä½œ" class="header-anchor">#</a> MongDBåŸºæœ¬å¢åˆ æ”¹æŸ¥æ“ä½œ</h3> <h4 id="å¢"><a href="#å¢" class="header-anchor">#</a> å¢</h4> <ul><li>å¢åŠ ä¸€æ¡æ•°æ®</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>    db.cc.insertOne({username: 'list', age: 12})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>å¢åŠ å¤šæ¡æ•°æ®</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code> db.cc.insertMany([
    {username: 'list', age: 13},
    {username: 'list2', age: 15}
 ])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="æŸ¥"><a href="#æŸ¥" class="header-anchor">#</a> æŸ¥</h4> <ul><li>æŸ¥æ‰¾</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>db.cc.find({username: 'list'})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>æŸ¥æ‰¾ä¸€æ¡æ•°æ®</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>db.cc.findOne({username: 'list'})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>æŒ‰æ¡ä»¶æŸ¥æ‰¾</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>    db.cc.find({age: {$gt: 15}})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="æ›´æ–°"><a href="#æ›´æ–°" class="header-anchor">#</a> æ›´æ–°</h4> <ul><li>æŠŠusernameç­‰äºlisiçš„å¹´é¾„æ›´æ–°ä¸º60</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>    db.cc.updateOne({username: 'lisi'}, {$set:{age:60}})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>æŠŠå¹´é¾„å¤§äº1çš„usernameæ”¹ä¸ºlisi</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>   db.cc.updateMany({age:{$gt: 1}}, {$set: {username: 'lisi'}})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="header-anchor">#</a> åˆ é™¤</h4> <ul><li>åˆ é™¤å¹´é¾„ç­‰äº60çš„æ•°æ®</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>    db.cc.deleteOne({age: 60})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>åˆ é™¤å¹´é¾„å¤§äº100çš„æ•°æ®</li></ul> <div class="language-mongodb line-numbers-mode"><pre class="language-text"><code>   db.cc.deleteMany({age: {$gt:100}})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ä½¿ç”¨nodeé“¾æ¥mongodb"><a href="#ä½¿ç”¨nodeé“¾æ¥mongodb" class="header-anchor">#</a> ä½¿ç”¨Nodeé“¾æ¥MongoDB</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> MongoClient <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'mongodb://localhost:27017'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">clinetDB</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// åº“å</span>
    <span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">'mytest'</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connected successfully to server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é›†åˆ</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> collection <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">clinetDB</span><span class="token punctuation">(</span><span class="token string">'cc'</span><span class="token punctuation">)</span>
    
    <span class="token comment">// æŸ¥æ‰¾ccé›†åˆä¸‹çš„æ‰€æœ‰</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> d<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">// æ’å…¥ä¸€æ¡æ•°æ®</span>
    <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'dave'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// å¤šæ¡æ’å…¥</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'dave1'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'dave2'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
     <span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment">// æŸ¥æ‰¾usernameä¸ºdaveçš„æ•°æ®</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'dave'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> d<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">// æ›´æ–°usernameä¸ºdaveçš„æ•°æ®ï¼ŒæŠŠå¹´é¾„æ”¹ä¸º10å²</span>
    <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'dave'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>$set<span class="token operator">:</span> <span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// æ›´æ–° æŠŠå¹´é¾„å¤§äº12å²çš„usernameæ”¹ä¸ºwangwu</span>
    <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token punctuation">{</span>$gt<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$set<span class="token operator">:</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">'wangwu'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   
   <span class="token comment">// åˆ é™¤å¹´é¾„å¤§äº10å²çš„ç¬¬ä¸€æ¡æ•°æ®</span>
    <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token punctuation">{</span>$gt<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// åˆ é™¤å¹´é¾„å¤§äº10å²çš„æ‰€æœ‰æ•°æ®</span>
    <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token punctuation">{</span>$gt<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><ul><li>æ–‡æ¡£åœ°å€ https://www.mongodb.com/docs/drivers/node/current</li></ul> <h3 id="express-ä¸­é—´ä»¶"><a href="#express-ä¸­é—´ä»¶" class="header-anchor">#</a> Express ä¸­é—´ä»¶</h3> <h4 id="é”™è¯¯å¤„ç†ä¸­é—´ä»¶"><a href="#é”™è¯¯å¤„ç†ä¸­é—´ä»¶" class="header-anchor">#</a> é”™è¯¯å¤„ç†ä¸­é—´ä»¶</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å½“æœ‰4ä¸ªå‚æ•°æ—¶ï¼Œexpress ä¼šæŠŠå®ƒä½œä¸ºå¤„ç†é”™è¯¯ä½¿ç”¨</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'service Error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="å†…ç½®ä¸­é—´ä»¶"><a href="#å†…ç½®ä¸­é—´ä»¶" class="header-anchor">#</a> å†…ç½®ä¸­é—´ä»¶</h4> <ul><li>express.json()ã€express.urlencoded() ç­‰</li></ul> <h4 id="ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶"><a href="#ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶" class="header-anchor">#</a> ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</h4> <ul><li>corsã€morgan(æ—¥å¿—è®°å½•)</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å¼€å‘ç¯å¢ƒè®°å½•æ—¥å¿—</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="getä¼ å‚"><a href="#getä¼ å‚" class="header-anchor">#</a> GETä¼ å‚</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// http:localhost/user/1/video/2</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id/video/:vid'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
    req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>vid
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// http:localhost?user=1&amp;video=2</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    req<span class="token punctuation">.</span>query
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="restful-api"><a href="#restful-api" class="header-anchor">#</a> Restful API</h3> <ul><li>https://restfulapi.cn</li></ul> <h2 id="æ¥å£æ–‡æ¡£"><a href="#æ¥å£æ–‡æ¡£" class="header-anchor">#</a> æ¥å£æ–‡æ¡£</h2> <h3 id="æ¥å£è¯´æ˜"><a href="#æ¥å£è¯´æ˜" class="header-anchor">#</a> æ¥å£è¯´æ˜</h3> <ul><li>åŸºäºRESTful API æ¥å£è§„èŒƒ</li> <li>åŸºäºJWT èº«ä»½è®¤è¯</li> <li>ä½¿ç”¨cors è·¨åŸŸ</li> <li>æ¥å£åŸºç¡€è¯·æ±‚åœ°å€ï¼šhttp:// 127.0.0.1:3000/api/v1</li> <li>ä½¿ç”¨JSON æ ¼å¼è¿›è¡Œæ•°æ®é€šä¿¡</li></ul> <h3 id="ç”¨æˆ·æ³¨å†Œ"><a href="#ç”¨æˆ·æ³¨å†Œ" class="header-anchor">#</a> ç”¨æˆ·æ³¨å†Œ</h3> <p>path: /user/registers
methods:post
æ˜¯å¦è®¤è¯: false</p> <table><thead><tr><th>å­—æ®µå</th> <th>å­—æ®µç±»å‹</th> <th>æ˜¯å¦å¿…é¡»</th></tr></thead> <tbody><tr><td>username</td> <td>string</td> <td>true</td></tr> <tr><td>email</td> <td>string</td> <td>true</td></tr> <tr><td>phone</td> <td>string</td> <td>true</td></tr> <tr><td>password</td> <td>string</td> <td>true</td></tr></tbody></table> <p>è¯·æ±‚ç¤ºä¾‹:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dave&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;phone&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13312345678&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å“åº”ç¤ºä¾‹:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// success</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dave&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1232@qq.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;phone&quot;</span><span class="token operator">:</span> <span class="token number">13312345648</span><span class="token punctuation">,</span>
    <span class="token string">&quot;createAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-09-23T09:03:45.232Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;updateAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-09-23T09:03:45.232Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;632d76ace3388d81e4f92ef0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;__v&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token comment">//error</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;errors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;å¹´é¾„ä¸èƒ½ä¸ºç©º&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;param&quot;</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;location&quot;</span><span class="token operator">:</span> <span class="token string">&quot;body&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="è·¯ç”±æ¨¡å—"><a href="#è·¯ç”±æ¨¡å—" class="header-anchor">#</a> è·¯ç”±æ¨¡å—</h2> <blockquote><p>è·¯ç”±å’Œä¸šåŠ¡ä»£ç åˆ†ç¦» controller ç›®å½•å­˜æ”¾è·¯ç”±çš„ä¸šåŠ¡ä»£ç ï¼Œ routerå­˜æ”¾è·¯ç”±</p></blockquote> <p>æ ¹ç›®å½•ä¸‹åˆ›å»º controller ç›®å½•</p> <ul><li>controller / userController.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ ¹ç›®å½•ä¸‹åˆ›å»º router ç›®å½•</p> <ul><li>user.js ç”¨æˆ·ç›¸å…³çš„ç†ç”±</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/userController'</span><span class="token punctuation">)</span> 

router
<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>login<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>list<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>delete<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>register<span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>index.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>app.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api/v1'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="æ•°æ®å¤„ç†æ¨¡å—-mongoose"><a href="#æ•°æ®å¤„ç†æ¨¡å—-mongoose" class="header-anchor">#</a> æ•°æ®å¤„ç†æ¨¡å—(mongoose)</h2> <blockquote><p>æ–‡æ¡£åœ°å€ https://mongoosejs.com</p></blockquote> <h3 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm install mongoose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="header-anchor">#</a> ä½¿ç”¨</h3> <p>æ ¹ç›®å½•ä¸‹æ–°å»º model æ–‡ä»¶å¤¹</p> <ul><li><code>model / baseModel.js</code> å­˜æ”¾å…±æœ‰çš„ model(æ¨¡å‹)</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    createAt<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Date<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    updateAt<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Date<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><code>model / userModel.js</code> å­˜æ”¾ç”¨æˆ·ç›¸å…³çš„ model æ¨¡å‹</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> baseModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./baseModel'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> md5 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/md5'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        username<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> String<span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> String<span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">// å¯†ç  md5 åŠ å¯†</span>
            <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token function">md5</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// æŸ¥è¯¢æ—¶ï¼Œä¸è¿”å›å¯†ç </span>
            select<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        age<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        email<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> String<span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        phone<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>baseModel
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> userSchema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ul><li><code>model / index.js</code> è¿æ¥ mongoose å¹¶å¯¼å…¥ user æ¨¡å‹</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰videoåˆ™è‡ªåŠ¨åˆ›å»º</span>
   <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb å·²è¿æ¥'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// mongodbä¼šæŠŠUå˜ä¸ºå°å†™,ç»“å°¾åŠ s users</span>
    <span class="token comment">// å¦‚æœUserä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º</span>
    User<span class="token operator">:</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./userModel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="è¡¨å•éªŒè¯"><a href="#è¡¨å•éªŒè¯" class="header-anchor">#</a> è¡¨å•éªŒè¯</h2> <blockquote><p>æ–‡æ¡£åœ°å€ https://express-validator.github.io/docs/running-imperatively.html</p></blockquote> <h3 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="header-anchor">#</a> å®‰è£…</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm install express<span class="token operator">-</span>validator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="header-anchor">#</a> ä½¿ç”¨</h3> <p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºvalidatorç›®å½• /middleware/validator</p> <ul><li>userValidator.js ç”¨æˆ·è¡¨å•æ ¡éªŒ</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">const</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-validator'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> validator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./errorBack'</span><span class="token punctuation">)</span>
    
    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>register <span class="token operator">=</span> <span class="token function">validator</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// bail ä¸Šä¸€ä¸ªéªŒè¯é€šè¿‡ååœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªéªŒè¯</span>
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·åä¸èƒ½ä¸ºç©º'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>min<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·åé•¿åº¦ä¸èƒ½å°äº3ä¸ªå­—ç¬¦å¹¶ä¸”ä¸èƒ½å¤§äº10ä¸ªå­—ç¬¦'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'å¹´é¾„ä¸èƒ½ä¸ºç©º'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// custom è‡ªå®šä¹‰éªŒè¯</span>
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'é‚®ç®±ä¸èƒ½ä¸ºç©º'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">isEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'é‚®ç®±æ ¼å¼æœ‰è¯¯'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'val'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
          <span class="token keyword">const</span> emailValidate <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>email<span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>emailValidate<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'é‚®ç®±å·²æ³¨å†Œ'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'phone'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'æ‰‹æœºå·ä¸èƒ½ä¸ºç©º'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">isMobilePhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'æ‰‹æœºå·æ ¼å¼æœ‰è¯¯'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> phoneValidate <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>phone<span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>phoneValidate<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'æ‰‹æœºå·å·²æ³¨å†Œ'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ul><li>errorBack.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> validationResult <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-validator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">validations</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// å¾ªç¯éªŒè¯æ¯é¡¹</span>
      <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>validations<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">validation</span> <span class="token operator">=&gt;</span> validation<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
      <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  
      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> errors<span class="token operator">:</span>errors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>ç»™è·¯ç”±æ·»åŠ æ ¡éªŒ router/user.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> userValidator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../middleware/validator/userValidator'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/userController'</span><span class="token punctuation">)</span> 

<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> userValidator<span class="token punctuation">.</span>register <span class="token punctuation">,</span> controller<span class="token punctuation">.</span>register<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="ç”¨æˆ·æ³¨å†Œ-2"><a href="#ç”¨æˆ·æ³¨å†Œ-2" class="header-anchor">#</a> ç”¨æˆ·æ³¨å†Œ</h2> <ul><li>controller/userController.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../model/index'</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> userdb <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
   <span class="token keyword">const</span> dbBack <span class="token operator">=</span> <span class="token keyword">await</span> userdb<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">const</span> user <span class="token operator">=</span> dbBack<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">delete</span> user<span class="token punctuation">.</span>password
   res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// router/user.js</span>
<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> userValidator<span class="token punctuation">.</span>register <span class="token punctuation">,</span> controller<span class="token punctuation">.</span>register<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="jwt-è®¤è¯"><a href="#jwt-è®¤è¯" class="header-anchor">#</a> JWT è®¤è¯</h2> <blockquote><p>ä»‹ç» https://restfulapi.cn/page/jwt
æ–‡æ¡£åœ°å€ https://github.com/auth0/node-jsonwebtoken</p></blockquote> <h3 id="å®‰è£…-3"><a href="#å®‰è£…-3" class="header-anchor">#</a> å®‰è£…</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm i jsonwebtoken
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ä½¿ç”¨-3"><a href="#ä½¿ç”¨-3" class="header-anchor">#</a> ä½¿ç”¨</h3> <ul><li>åœ¨ utils ç›®å½•ä¸‹æ–°å»º jwt.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å›è°ƒå˜promise</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// éšæœºç­¾å</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> uuid <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config/config.default'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sign <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>sign<span class="token punctuation">)</span>
<span class="token keyword">const</span> verify <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>verify<span class="token punctuation">)</span>

<span class="token comment">// åˆ›å»ºtoken</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">createJwtToken</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">userinfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userinfo<span class="token punctuation">}</span><span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token punctuation">{</span> expiresIn<span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> token
<span class="token punctuation">}</span>

<span class="token comment">// æ ¡éªŒtoken</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">verifyToken</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bearerToken <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bearerToken<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">402</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">&quot;tokenä¸å­˜åœ¨&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> bearerToken<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> uuid<span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token string">'402'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'æ— æ•ˆtoken'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="ç”¨æˆ·ç™»é™†"><a href="#ç”¨æˆ·ç™»é™†" class="header-anchor">#</a> ç”¨æˆ·ç™»é™†</h2> <ul><li><code>controller/userController.js</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>createJwtToken<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/jwt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../model/index'</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> dbUser <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dbUser<span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// åˆ›å»ºtoken</span>
   <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createJwtToken</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
   <span class="token keyword">const</span> user <span class="token operator">=</span> dbUser<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   user<span class="token punctuation">.</span>token <span class="token operator">=</span> token
   res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="è·¯ç”±æƒé™è®¤è¯"><a href="#è·¯ç”±æƒé™è®¤è¯" class="header-anchor">#</a> è·¯ç”±æƒé™è®¤è¯</h2> <ul><li>router/user.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>verifyToken<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/jwt'</span><span class="token punctuation">)</span>
<span class="token comment">// verifyToken ä½œä¸ºä¸­é—´ä»¶ä¼ äºº</span>
router
<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span> verifyToken<span class="token punctuation">,</span> controller<span class="token punctuation">.</span>list<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="ç”¨æˆ·ä¿®æ”¹"><a href="#ç”¨æˆ·ä¿®æ”¹" class="header-anchor">#</a> ç”¨æˆ·ä¿®æ”¹</h2> <blockquote><p>ç”¨æˆ·åã€æ‰‹æœºå·ã€é‚®ç®± æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½ä¿®æ”¹ä¸ºå·²ç»å­˜åœ¨çš„</p></blockquote> <ul><li>middleware / validator / userValidator.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token function">validator</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>min<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·åé•¿åº¦ä¸èƒ½å°äº3ä¸ªå­—ç¬¦å¹¶ä¸”ä¸èƒ½å¤§äº10ä¸ªå­—ç¬¦'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> userValida <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">// ä¸å¯ä»¥æ”¹ä¸ºå·²ç»å­˜åœ¨çš„ç”¨æˆ·å</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>userValida<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'ç”¨æˆ·åå·²æ³¨å†Œ'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">isEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">'é‚®ç®±æ ¼å¼æœ‰è¯¯'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> emailVallida <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>email<span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>emailVallida<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'é‚®ç®±å·²æ³¨å†Œ'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">body</span><span class="token punctuation">(</span><span class="token string">'phone'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> phoneVallida <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>phone<span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>phoneVallida<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'æ‰‹æœºå·å·²æ³¨å†Œ'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>controller/userController.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userid <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token comment">// æ›´æ–°idä¸ºxxxçš„æ•°æ®   new:true è¿”å›æ›´æ–°åçš„æ•°æ®ï¼Œé»˜è®¤è¿”å›æ›´æ–°å‰çš„æ•°æ®</span>
    <span class="token keyword">const</span> updatedb <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>userid<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>updatedb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>router / user.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>router
<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/update'</span><span class="token punctuation">,</span> userValidator<span class="token punctuation">.</span>update<span class="token punctuation">,</span> verifyToken<span class="token punctuation">,</span> controller<span class="token punctuation">.</span>update<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç†"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç†" class="header-anchor">#</a> æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç†</h2> <h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="header-anchor">#</a> æ–‡ä»¶ä¸Šä¼ </h3> <h4 id="å®‰è£…-4"><a href="#å®‰è£…-4" class="header-anchor">#</a> å®‰è£…</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// https://www.npmjs.com/package/multer</span>
    npm i multer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="header-anchor">#</a> å›¾ç‰‡ä¸Šä¼ </h4> <ul><li>router / user.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/userController'</span><span class="token punctuation">)</span> 
<span class="token keyword">const</span> <span class="token punctuation">{</span>verifyToken<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/jwt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> multer  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span>
<span class="token comment">// dest ä¸Šä¼ åˆ°å“ª</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dest<span class="token operator">:</span> <span class="token string">'public/'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

router
<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/uploadimg'</span><span class="token punctuation">,</span> verifyToken<span class="token punctuation">,</span> 
<span class="token comment">// uploadimg ä¸å®¢æˆ·ç«¯çº¦å®šçš„name</span>
<span class="token comment">// upload.single ä½œä¸ºä¸­é—´ä»¶ ä¼šæŠŠä¸Šä¼ åçš„ä¿¡æ¯ä¼ åˆ°controller.uploadimgï¼Œé€šè¿‡ req.file æ¥æ”¶</span>

upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'uploadimg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    controller<span class="token punctuation">.</span>uploadimg<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>controller / userController.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rename <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>rename<span class="token punctuation">)</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">uploadimg</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filename <span class="token operator">=</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">public/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">const</span> originalname <span class="token operator">=</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> fix <span class="token operator">=</span> originalname<span class="token punctuation">[</span>originalname<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">// ä¸Šä¼ åˆ°çš„æ–‡ä»¶æ²¡æœ‰åç¼€ï¼Œéœ€è¦é‡å‘½å</span>
    <span class="token keyword">await</span> <span class="token function">rename</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> path <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> fix<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token operator">:</span> filename <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> fix<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="è…¾è®¯äº‘è§†é¢‘ç‚¹æ’­æœåŠ¡-vod"><a href="#è…¾è®¯äº‘è§†é¢‘ç‚¹æ’­æœåŠ¡-vod" class="header-anchor">#</a> è…¾è®¯äº‘è§†é¢‘ç‚¹æ’­æœåŠ¡(VoD)</h3> <blockquote><p>è§†é¢‘è½¬ç ã€é˜²ç›—é“¾ç­‰åŠŸèƒ½</p></blockquote> <ol><li>å‰ç«¯å‘èµ·è¯·æ±‚åˆ°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œ</li> <li>æœåŠ¡å™¨å†å»è¯·æ±‚é˜¿é‡Œäº‘è·å–ä¸Šä¼ å‡­è¯ç»™å®¢æˆ·ç«¯åšè¿”å›ï¼Œ</li> <li>å®¢æˆ·ç«¯æ ¹æ®å‡­è¯ä¸Šä¼ è§†é¢‘</li> <li>å®¢æˆ·ç«¯ä¸Šä¼ æˆåŠŸåæŠŠé˜¿é‡Œäº‘æä¾›çš„è§†é¢‘idï¼Œå…¥åº“åˆ°æˆ‘ä»¬è‡ªå·±çš„æ•°æ®åº“</li></ol> <h4 id="è·å–vodä¸Šä¼ å‡­è¯åŠåœ°å€"><a href="#è·å–vodä¸Šä¼ å‡­è¯åŠåœ°å€" class="header-anchor">#</a> è·å–VoDä¸Šä¼ å‡­è¯åŠåœ°å€</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æœåŠ¡ç«¯</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">vod</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;querystring&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¡®å®š app çš„äº‘ API å¯†é’¥</span>
    <span class="token keyword">var</span> secret_id <span class="token operator">=</span> <span class="token string">&quot;AKIDd9SXP4UVJuHRP9h06yd3SffQzMahgdVF&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> secret_key <span class="token operator">=</span> <span class="token string">&quot;d6RhKF4mLl2BATdgaN2Y3PbfeVHwTr5A&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¡®å®šç­¾åçš„å½“å‰æ—¶é—´å’Œå¤±æ•ˆæ—¶é—´</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> expired <span class="token operator">=</span> current <span class="token operator">+</span> <span class="token number">86400</span><span class="token punctuation">;</span>  <span class="token comment">// ç­¾åæœ‰æ•ˆæœŸï¼š1å¤©</span>
    <span class="token comment">// å‘å‚æ•°åˆ—è¡¨å¡«å…¥å‚æ•°</span>
    <span class="token keyword">var</span> arg_list <span class="token operator">=</span> <span class="token punctuation">{</span>
    secretId <span class="token operator">:</span> secret_id<span class="token punctuation">,</span>
    currentTimeStamp <span class="token operator">:</span> current<span class="token punctuation">,</span>
    expireTime <span class="token operator">:</span> expired<span class="token punctuation">,</span>
    random <span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¡ç®—ç­¾å</span>
    <span class="token keyword">const</span> orignal <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arg_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> orignal_buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>orignal<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> hmac <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHmac</span><span class="token punctuation">(</span><span class="token string">&quot;sha1&quot;</span><span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> hmac_buffer <span class="token operator">=</span> hmac<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>orignal_buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> signature <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>hmac_buffer<span class="token punctuation">,</span> orignal_buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;base64&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>sign<span class="token operator">:</span> signature<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å®¢æˆ·ç«¯è·å–</span>
<span class="token keyword">function</span> <span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3000/api/v1/video/getvod'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sign<span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sign<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="vodæœåŠ¡-å®¢æˆ·ç«¯ä¸Šä¼ "><a href="#vodæœåŠ¡-å®¢æˆ·ç«¯ä¸Šä¼ " class="header-anchor">#</a> VODæœåŠ¡-å®¢æˆ·ç«¯ä¸Šä¼ </h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;mediaFile&quot;</span> @change<span class="token operator">=</span><span class="token string">&quot;change&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
 
<span class="token keyword">const</span> tcVod <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcVod</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  getSignature<span class="token operator">:</span> getSignature <span class="token comment">// å‰æ–‡ä¸­æ‰€è¿°çš„è·å–ä¸Šä¼ ç­¾åçš„å‡½æ•°</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mediaFile <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> uploader <span class="token operator">=</span> tcVod<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mediaFile<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
uploader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'media_progress'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>percent<span class="token punctuation">)</span> <span class="token comment">// è¿›åº¦</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
uploader<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">doneResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// deal with doneResult</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'doneResult'</span><span class="token punctuation">,</span>doneResult<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// deal with error</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="è§†é¢‘ä¿¡æ¯å…¥åº“æ“ä½œ"><a href="#è§†é¢‘ä¿¡æ¯å…¥åº“æ“ä½œ" class="header-anchor">#</a> è§†é¢‘ä¿¡æ¯å…¥åº“æ“ä½œ</h4> <ul><li>æ–°å»º modelå±‚ videoModel.jsï¼Œä¸»è¦æŠŠä¸Šä¼ åˆ°è…¾è®¯äº‘åè¿”å›çš„vodvideoId å’Œç”¨æˆ·idä¼ ç»™åç«¯</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> baseModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./baseModel'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> videoSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    vodvideoId<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// å…³è”users é›†åˆ</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cover<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    videoComment<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    likeCount<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dislikeCount<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>baseModel
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> videoSchema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><ul><li>åˆ›å»ºè§†é¢‘</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">createVideo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> userid <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    body<span class="token punctuation">.</span>user <span class="token operator">=</span> userid
    <span class="token keyword">const</span> dbvideo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Video</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
    <span class="token keyword">const</span> dbback <span class="token operator">=</span> <span class="token keyword">await</span> dbvideo<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dbback<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="è§†é¢‘åˆ—è¡¨åŠåˆ†é¡µå±•ç¤º"><a href="#è§†é¢‘åˆ—è¡¨åŠåˆ†é¡µå±•ç¤º" class="header-anchor">#</a> è§†é¢‘åˆ—è¡¨åŠåˆ†é¡µå±•ç¤º</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">videolist</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>pageNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize <span class="token operator">=</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> dbdata <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>createAt<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    
        <span class="token keyword">const</span> videoCount <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>videolist<span class="token operator">:</span> dbdata<span class="token punctuation">,</span> videoCount<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="è·å–è§†é¢‘è¯¦æƒ…"><a href="#è·å–è§†é¢‘è¯¦æƒ…" class="header-anchor">#</a> è·å–è§†é¢‘è¯¦æƒ…</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„video_idæŸ¥æ‰¾</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">videoDetail</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>video_id<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params
    <span class="token keyword">const</span> dbBack <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>video_id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'username cover image'</span><span class="token punctuation">)</span>
    <span class="token function">redisVideoHots</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dbBack<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="é¢‘é“è®¢é˜…ä¸å–æ¶ˆè®¢é˜…"><a href="#é¢‘é“è®¢é˜…ä¸å–æ¶ˆè®¢é˜…" class="header-anchor">#</a> é¢‘é“è®¢é˜…ä¸å–æ¶ˆè®¢é˜…</h2> <ol><li>ç”¨æˆ·ä¸èƒ½å…³æ³¨è‡ªå·±</li> <li>éœ€è¦æ‹¿åˆ°ä¸¤ä¸ªIDï¼Œå½“å‰ç™»é™†ç”¨æˆ·çš„IDå’Œè¦å…³æ³¨çš„IDï¼Œå¦‚æœå½“å‰ç”¨æˆ·IDå’Œè¦å…³æ³¨çš„IDå·²ç»å­˜åœ¨ï¼Œè¯´æ˜å·²ç»å…³æ³¨å¦åˆ™æ‰§è¡Œå…¥åº“æ“ä½œ</li> <li>A å…³æ³¨ Bï¼ŒBç›¸å½“äºå¤šä¸€ä¸ªç²‰ä¸ï¼Œæ‰€ä»¥è¦ç»™ B ç²‰ä¸åŠ  1</li></ol> <ul><li>modelå±‚</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> baseModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./baseModel'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> subscribeSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    channel<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>baseModel
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> subscribeSchema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>è®¢é˜…ï¼ˆå…³æ³¨ï¼‰</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è‡ªå·±ä¸èƒ½å…³æ³¨è‡ªå·± å½“å‰ç™»é™†çš„id æ¯”è¾ƒ ä¼ è¿‡æ¥çš„id</span>
    <span class="token keyword">const</span> userid <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token keyword">const</span> channel_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>channel_id
    <span class="token keyword">if</span><span class="token punctuation">(</span>userid <span class="token operator">===</span> channel_id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'ä¸èƒ½å…³æ³¨è‡ªå·±'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. åˆ¤æ–­ ç”¨æˆ·æ˜¯å¦å·²ç»å…³æ³¨è¿‡æ­¤ç”¨æˆ· channel_id </span>
    <span class="token keyword">const</span> subscribe <span class="token operator">=</span> <span class="token keyword">await</span> Subscribe<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        user<span class="token operator">:</span> userid<span class="token punctuation">,</span>
        channel<span class="token operator">:</span> channel_id
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>subscribe<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'å·²ç»å…³æ³¨è¿‡äº†'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. æœªå…³æ³¨ å­˜å…¥æ•°æ®åº“ï¼Œå¹¶ä½¿è¢«å…³æ³¨çš„ç²‰ä¸åŠ 1</span>
    <span class="token keyword">const</span> insertdb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        user<span class="token operator">:</span> userid<span class="token punctuation">,</span>
        channel<span class="token operator">:</span> channel_id
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> insertResult <span class="token operator">=</span> <span class="token keyword">await</span> insertdb<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>channel_id<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>subscribecount <span class="token operator">++</span>
        <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token string">'å…³æ³¨æˆåŠŸ'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li>å–æ¶ˆè®¢é˜…</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">unsubscribe</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userid <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token keyword">const</span> channel_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>channel_id
    <span class="token keyword">if</span><span class="token punctuation">(</span>userid <span class="token operator">===</span> channel_id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'ä¸èƒ½å–æ¶ˆå…³æ³¨è‡ªå·±'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> subscribe <span class="token operator">=</span> <span class="token keyword">await</span> Subscribe<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        user<span class="token operator">:</span> userid<span class="token punctuation">,</span>
        channel<span class="token operator">:</span> channel_id
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>subscribe<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">await</span> subscribe<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>channel_id<span class="token punctuation">)</span>
       user<span class="token punctuation">.</span>subscribecount <span class="token operator">--</span>
       <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'message'</span><span class="token operator">:</span> <span class="token string">&quot;å–æ¶ˆæˆåŠŸ&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'è¿˜æ²¡å…³æ³¨è¿‡'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="è·å–é¢‘é“ä¿¡æ¯"><a href="#è·å–é¢‘é“ä¿¡æ¯" class="header-anchor">#</a> è·å–é¢‘é“ä¿¡æ¯</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// A æŸ¥è¯¢ B çš„ä¿¡æ¯</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">getUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> isSubscribe <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token keyword">await</span> Subscribe<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            user<span class="token operator">:</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>
            channel<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user_id
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        isSubscribe <span class="token operator">=</span> record <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span>
    <span class="token keyword">let</span> formatObj <span class="token operator">=</span> lodash<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'cover'</span><span class="token punctuation">,</span> <span class="token string">'subscribecount'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>formatObj<span class="token punctuation">,</span>
        isSubscribe
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="æœç´¢æŸç”¨æˆ·-å…³æ³¨è¿‡è°"><a href="#æœç´¢æŸç”¨æˆ·-å…³æ³¨è¿‡è°" class="header-anchor">#</a> æœç´¢æŸç”¨æˆ· å…³æ³¨è¿‡è°</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">getSubscribe</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> subscribeList <span class="token operator">=</span> <span class="token keyword">await</span> Subscribe<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        user<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user_id
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'channel'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'subscribeList'</span><span class="token punctuation">,</span> subscribeList<span class="token punctuation">)</span>
    subscribeList <span class="token operator">=</span> subscribeList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> lodash<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>channel<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'cover'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'subscribecount'</span><span class="token punctuation">,</span> <span class="token string">'channeldes'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>subscribeList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="æŸ¥çœ‹è°å…³æ³¨è¿‡æˆ‘-æˆ‘çš„ç²‰ä¸åˆ—è¡¨"><a href="#æŸ¥çœ‹è°å…³æ³¨è¿‡æˆ‘-æˆ‘çš„ç²‰ä¸åˆ—è¡¨" class="header-anchor">#</a> æŸ¥çœ‹è°å…³æ³¨è¿‡æˆ‘ï¼ˆæˆ‘çš„ç²‰ä¸åˆ—è¡¨ï¼‰</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">getChannel</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> channelList <span class="token operator">=</span> <span class="token keyword">await</span> Subscribe<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        channel<span class="token operator">:</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    channelList <span class="token operator">=</span> channelList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> lodash<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'cover'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'subscribecount'</span><span class="token punctuation">,</span> <span class="token string">'channeldes'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>channelList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="è§†é¢‘è¯„è®º"><a href="#è§†é¢‘è¯„è®º" class="header-anchor">#</a> è§†é¢‘è¯„è®º</h2> <ul><li>modelå±‚ commentModel.js å­—æ®µä¸ºè°å¯¹å“ªæ¡è§†é¢‘çš„è¯„è®ºåŠè¯„è®ºå†…å®¹</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> baseModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./baseModel'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> commentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    video<span class="token operator">:</span> <span class="token punctuation">{</span>
       type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
       required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
       ref<span class="token operator">:</span> <span class="token string">'Video'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>baseModel
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> commentSchema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>è¯„è®º</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">comment</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token keyword">const</span> video <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>video_id
    <span class="token keyword">const</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content
    <span class="token keyword">const</span> videodb <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>videodb<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> dbback <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                user<span class="token punctuation">,</span>
                video<span class="token punctuation">,</span>
                content
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            videodb<span class="token punctuation">.</span>videoComment <span class="token operator">++</span>
            <span class="token keyword">await</span> videodb<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">redisVideoHots</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dbback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token string">'è§†é¢‘ä¸å­˜åœ¨'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="åˆ é™¤è§†é¢‘è¯„è®º"><a href="#åˆ é™¤è§†é¢‘è¯„è®º" class="header-anchor">#</a> åˆ é™¤è§†é¢‘è¯„è®º</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">commentDelete</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> video_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>video_id
    <span class="token keyword">const</span> comment_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>comment_id
    <span class="token comment">// è§†é¢‘æ˜¯å¦å­˜åœ¨</span>
    <span class="token comment">// è¯„è®ºæ˜¯å¦å­˜åœ¨</span>
    <span class="token comment">// æ˜¯å¦æ˜¯è‡ªå·±å†™çš„è¯„è®º</span>
    <span class="token keyword">const</span> videodb <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>video_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>videodb<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'è§†é¢‘ä¸å­˜åœ¨'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> commentdb <span class="token operator">=</span> <span class="token keyword">await</span> Comment<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>comment_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>commentdb<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'è¯„è®ºä¸å­˜åœ¨'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>commentdb<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'è¯„è®ºä¸å¯åˆ é™¤'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> commentdb<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    videodb<span class="token punctuation">.</span>videoCount <span class="token operator">--</span> 
    <span class="token keyword">await</span> videodb<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'message'</span><span class="token operator">:</span> <span class="token string">'åˆ é™¤æˆåŠŸ'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="è§†é¢‘è¯„è®ºåˆ—è¡¨"><a href="#è§†é¢‘è¯„è®ºåˆ—è¡¨" class="header-anchor">#</a> è§†é¢‘è¯„è®ºåˆ—è¡¨</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">commentlist</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>pageNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> video_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>video_id
    <span class="token keyword">const</span> comment <span class="token operator">=</span> <span class="token keyword">await</span> Comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>video<span class="token operator">:</span> video_id<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'username image'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">await</span> Comment<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">{</span>video<span class="token operator">:</span> video_id<span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="è§†é¢‘æ˜¯å¦å–œæ¬¢"><a href="#è§†é¢‘æ˜¯å¦å–œæ¬¢" class="header-anchor">#</a> è§†é¢‘æ˜¯å¦å–œæ¬¢</h2> <ul><li>modelå±‚ videolikeModel.js å“ªä¸ªç”¨æˆ·å¯¹å“ªæ¡è§†é¢‘æ˜¯å¦å–œæ¬¢</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> baseModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./baseModel'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> videolikeSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// å…³è”users é›†åˆ</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    video<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// å…³è” videos é›†åˆ</span>
        ref<span class="token operator">:</span> <span class="token string">'Video'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    like<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
        <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>baseModel
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> videolikeSchema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>æ˜¯å¦å–œæ¬¢è§†é¢‘</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">videoLike</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token keyword">const</span> video_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>video_id
    <span class="token keyword">let</span> islike <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// 1. æŸ¥æ‰¾è§†é¢‘æ˜¯å¦å­˜åœ¨</span>
   <span class="token keyword">const</span> video <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>video_id<span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>video<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'è§†é¢‘ä¸å­˜åœ¨'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">const</span> videodbBack <span class="token operator">=</span> <span class="token keyword">await</span> Videolike<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        user<span class="token punctuation">,</span>
        video<span class="token operator">:</span> video_id
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'videodbBack.like'</span><span class="token punctuation">,</span> videodbBack<span class="token punctuation">)</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>videodbBack <span class="token operator">&amp;&amp;</span> videodbBack<span class="token punctuation">.</span>like <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        videodbBack<span class="token punctuation">.</span>like <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">await</span> videodbBack<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        islike <span class="token operator">=</span> <span class="token boolean">false</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>videodbBack <span class="token operator">&amp;&amp;</span> videodbBack<span class="token punctuation">.</span>like <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        videodbBack<span class="token punctuation">.</span>like <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">await</span> videodbBack<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">redisVideoHots</span><span class="token punctuation">(</span>video_id<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        islike <span class="token operator">=</span> <span class="token boolean">true</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Videolike</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            user<span class="token punctuation">,</span>
            video<span class="token operator">:</span> video_id<span class="token punctuation">,</span>
            like<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        islike <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">redisVideoHots</span><span class="token punctuation">(</span>video_id<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   video<span class="token punctuation">.</span>likeCount <span class="token operator">=</span> <span class="token keyword">await</span> Videolike<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">{</span>video<span class="token operator">:</span> video_id<span class="token punctuation">,</span> like<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   video<span class="token punctuation">.</span>dislikeCount <span class="token operator">=</span> <span class="token keyword">await</span> Videolike<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">{</span>video<span class="token operator">:</span> video_id<span class="token punctuation">,</span> like<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token keyword">const</span> aa<span class="token operator">=</span> <span class="token keyword">await</span> video<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">,</span> aa<span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>video<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> islike<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="vim-å‘½ä»¤"><a href="#vim-å‘½ä»¤" class="header-anchor">#</a> vim å‘½ä»¤</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> æœç´¢   <span class="token operator">/</span>xxx <span class="token operator">+</span> å›è½¦  n é”®ä¸‹ä¸€ä¸ªxxx
 æ’å…¥å­—ç¬¦   i é”®
 å†™å…¥   <span class="token operator">:</span>w
 é€€å‡º   <span class="token operator">:</span>q
 æ˜¾ç¤ºè¡Œå· <span class="token operator">:</span><span class="token keyword">set</span> nu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="redis-ç¼“å­˜"><a href="#redis-ç¼“å­˜" class="header-anchor">#</a> Redis ç¼“å­˜</h2> <h3 id="å‘½ä»¤-2"><a href="#å‘½ä»¤-2" class="header-anchor">#</a> å‘½ä»¤</h3> <ul><li>redis-benchmark redisæ€§èƒ½æµ‹è¯•</li> <li>redis-check-rdb redis-check-aof æŒä¹…åŒ–å­˜å‚¨å·¥å…·</li> <li>redis-server æœåŠ¡å™¨æŒ‡ä»¤</li> <li>redis-cli å‘½ä»¤è¡Œredisè¿æ¥çš„ä¸€ä¸ªå®¢æˆ·ç«¯</li> <li>info server æŸ¥çœ‹redis æœåŠ¡å™¨ä¿¡æ¯</li> <li>info server å…¶ä¸­ <code>executable</code> è¡¨ç¤ºå½“å‰è¿è¡Œredisè„šæœ¬çš„åœ°æ–¹
<code>config_file</code> è¡¨ç¤ºå½“å‰è¿è¡Œredisçš„é…ç½®æ–‡ä»¶ä½ç½®</li></ul> <h3 id="åœ°å€"><a href="#åœ°å€" class="header-anchor">#</a> åœ°å€</h3> <ul><li>https://redis.io/docs/getting-started/installation/install-redis-on-mac-os</li></ul> <h3 id="redis-cli-å®¢æˆ·ç«¯é“¾æ¥"><a href="#redis-cli-å®¢æˆ·ç«¯é“¾æ¥" class="header-anchor">#</a> redis-cli å®¢æˆ·ç«¯é“¾æ¥</h3> <ul><li>keys *  æŸ¥çœ‹å­˜å‚¨çš„é”®</li> <li>redis-cli -h 127.0.0.1 -p 1234  æŒ‡å®šé“¾æ¥å’Œç«¯å£</li> <li>info server æŸ¥çœ‹æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€</li></ul> <h3 id="redis-æ•°æ®åº“"><a href="#redis-æ•°æ®åº“" class="header-anchor">#</a> redis æ•°æ®åº“</h3> <ul><li>select ï¼ˆindexï¼‰è¦è·³è½¬çš„åº“</li> <li>0 - 15 æ•°æ®åº“</li> <li>é»˜è®¤å­˜å‚¨åœ¨ 0 å·æ•°æ®åº“</li> <li>å„ä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®ä¸å…±äº«ï¼Œä½†æ˜¯ä¸æ”¯æŒå•ç‹¬è®¾ç½®å¯†ç </li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">set</span> age <span class="token number">1</span>    <span class="token comment">// è®¾ç½® s1 = 1</span>
    move s1 <span class="token number">12</span>  <span class="token comment">// ç§»åŠ¨ s1åˆ°12å·æ•°æ®åº“</span>
    keys <span class="token operator">*</span>     <span class="token comment">// æŸ¥çœ‹å­˜å‚¨çš„é”®</span>
    <span class="token keyword">get</span> age    <span class="token comment">// è·å– age çš„å€¼</span>
    <span class="token constant">MGET</span> s1 s2 <span class="token comment">// è·å–å¤šä¸ªå€¼</span>
    <span class="token constant">MSET</span> s1 <span class="token number">1</span> s2 <span class="token number">2</span> <span class="token comment">// ä¸€æ¬¡è®¾ç½®å¤šä¸ªå€¼ s1 = 1 s2 = 2</span>
    <span class="token constant">GETSET</span> s1 <span class="token number">99</span> <span class="token comment">// å°†ç»™å®šçš„keyçš„å€¼è®¾ç½®ä¸ºvalueï¼Œå¹¶ä¸”è¿”å›è¿™ä¸ªkeyä¹‹å‰çš„å€¼</span>
    <span class="token constant">STRLEN</span> s1 <span class="token comment">// è·å–é”®çš„é•¿åº¦</span>
    type s1 <span class="token comment">// è·å–å­˜å€¼çš„ç±»å‹</span>
    del s1 s2 <span class="token comment">// åˆ é™¤å¤šä¸ªå€¼</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="redis-æ•°æ®ç±»å‹"><a href="#redis-æ•°æ®ç±»å‹" class="header-anchor">#</a> redis æ•°æ®ç±»å‹</h3> <ul><li>String å­—ç¬¦ä¸²ï¼Œå…¶ä»–æ•°æ®ç±»å‹çš„åŸºç¡€ç±»å‹</li> <li>Hash æ•£åˆ—ï¼Œ æ˜¯ç”±ä¸å€¼ç›¸å…³çš„å­—æ®µç»„æˆçš„å†…å®¹ï¼Œå­—æ®µå’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²</li> <li>List åˆ—è¡¨ï¼Œæ ¹æ®æ’å…¥é¡ºåºæ’åºçš„å­—ç¬¦ä¸²å…ƒç´ çš„é›†åˆ</li> <li>Set æœªæ’åºçš„å­—ç¬¦ä¸²å…ƒç´ é›†åˆï¼Œé›†åˆä¸­çš„æ•°æ®æ˜¯ä¸é‡å¤çš„</li> <li>ZSet ä¸Setç±»ä¼¼ï¼Œä½†æ¯ä¸ªå­—ç¬¦ä¸²å…ƒç´ éƒ½ä¸ä¸€ä¸ªæ•°å€¼çš„ç›¸å…³è”ã€‚ä¸”æŒ‰æ•°å€¼å¤§å°è¿›è¡Œæ’åº</li></ul> <h3 id="redis-é”®å"><a href="#redis-é”®å" class="header-anchor">#</a> redis é”®å</h3> <ul><li>æœ€å¤§ 512M</li></ul> <h3 id="å“ˆå¸Œæ“ä½œæŒ‡ä»¤"><a href="#å“ˆå¸Œæ“ä½œæŒ‡ä»¤" class="header-anchor">#</a> å“ˆå¸Œæ“ä½œæŒ‡ä»¤</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token constant">HSET</span> hash h1 <span class="token number">1</span> h2 <span class="token number">2</span> h3 <span class="token number">3</span> <span class="token comment">// è®¾ç½®hashè¿”å›å­˜å‚¨çš„é•¿åº¦ - (integer) 3</span>
 
<span class="token constant">HKEYS</span> hash æŸ¥çœ‹hash å­˜å‚¨
<span class="token constant">HLEN</span> hash è·å– hashé•¿åº¦
<span class="token constant">HGET</span> hash h1 è·å–hashå€¼ 
<span class="token constant">HMGET</span> hash h1 h2 è·å–å¤šä¸ªhashå€¼
<span class="token constant">HGETALL</span> hash  <span class="token comment">// è·å–æ•´ä¸ªhashå€¼</span>
<span class="token constant">HSET</span> hash h1 <span class="token number">66</span> <span class="token comment">//ä¿®æ”¹ h1 çš„å€¼</span>
<span class="token constant">HDEL</span> hash h2  <span class="token comment">// åˆ é™¤ h2</span>
<span class="token constant">HGETALL</span> hash <span class="token comment">//åˆ é™¤æ‰€æœ‰ hash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="redisåˆ—è¡¨"><a href="#redisåˆ—è¡¨" class="header-anchor">#</a> Redisåˆ—è¡¨</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">LPUSH</span> l1 <span class="token number">11</span> <span class="token number">22</span> <span class="token number">33</span>  <span class="token comment">// åœ¨åˆ—è¡¨l1 é‡Œæ·»åŠ ä¸‰ä¸ªå€¼</span>
<span class="token constant">LRANGE</span> l1 <span class="token number">0</span> <span class="token number">3</span>  <span class="token comment">// è·å– l1 åˆ—è¡¨ 0 - 3 çš„å€¼</span>
<span class="token constant">LINSERT</span> l1 before <span class="token number">33</span> <span class="token number">00</span> <span class="token comment">// åœ¨ 33 ä¹‹å‰æ’å…¥ 00</span>
<span class="token constant">LINSERT</span> l1 after <span class="token number">33</span> <span class="token number">00</span> <span class="token comment">// åœ¨ 33 ä¹‹åæ’å…¥ 00</span>
<span class="token constant">LINDEX</span> l1  <span class="token number">3</span>  <span class="token comment">// è·å–æŸä¸€ä¸ªä½ç½®çš„å€¼</span>
<span class="token constant">LLEN</span> l1 <span class="token comment">// è·å–åˆ—è¡¨çš„é•¿åº¦</span>
<span class="token constant">LPOP</span> l1 <span class="token comment">// åˆ é™¤åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´  å¹¶è¿”å›åˆ é™¤çš„å…ƒç´ </span>
<span class="token constant">RPOP</span> l1 <span class="token comment">// åˆ é™¤åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´  å¹¶è¿”å›åˆ é™¤çš„å…ƒç´ </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="redis-é›†åˆ"><a href="#redis-é›†åˆ" class="header-anchor">#</a> Redis é›†åˆ</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token constant">SADD</span> s21 <span class="token number">11</span> <span class="token number">22</span> <span class="token number">33</span> <span class="token comment">// åœ¨s21é›†åˆä¸­æ·»åŠ ä¸‰ä¸ªå€¼</span>
 <span class="token constant">SMEMBERS</span> s21  <span class="token comment">// æ˜¾ç¤ºs21 é›†åˆä¸­çš„å…¨éƒ¨æ•°æ®</span>
 <span class="token constant">SCARD</span> s21   <span class="token comment">// è·å–s21 é›†åˆä¸­çš„æˆå‘˜ä¸ªæ•°</span>
 <span class="token constant">SRANDMEMBER</span> s21 <span class="token comment">// è·å–s21 é›†åˆä¸­çš„éšæœºå€¼</span>
 <span class="token constant">SRANDMEMBER</span> s21 <span class="token number">2</span> <span class="token comment">// è·å–s21 é›†åˆä¸­çš„2ä¸ªéšæœºå€¼</span>
 <span class="token constant">SREM</span> s21 <span class="token number">11</span>   <span class="token comment">// åˆ é™¤ s21 é›†åˆä¸­çš„ 11 æˆå‘˜</span>
 <span class="token constant">SPOP</span> s21    <span class="token comment">// éšæœºåˆ é™¤ s21 ä¸­çš„æˆå‘˜</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="redis-æœ‰åºé›†åˆ"><a href="#redis-æœ‰åºé›†åˆ" class="header-anchor">#</a> Redis æœ‰åºé›†åˆ</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">ZADD</span> z1  <span class="token number">5</span> u1 <span class="token number">6</span> u2 <span class="token number">66</span> u3 <span class="token number">44</span> u4 <span class="token number">55</span> u5  <span class="token comment">// z1(é›†åˆçš„åå­—) 5 é›†åˆçš„å€¼ï¼Œu1 å€¼çš„åå­—</span>

<span class="token constant">ZRANGE</span> z1  <span class="token number">3</span> <span class="token number">99</span> <span class="token comment">// è·å–3-99ä½ç½®çš„æœ‰åºé›†åˆï¼ˆä»ä½åˆ°é«˜ï¼‰</span>
<span class="token constant">ZREVRANGE</span> z1  <span class="token number">3</span> <span class="token number">99</span> <span class="token comment">// è·å–3-99ä½ç½®çš„æœ‰åºé›†åˆï¼ˆä»é«˜åˆ°ä½ï¼‰</span>
zrank z1 u2    <span class="token comment">// è·å–z1é›†åˆ u2 çš„æ’å ï¼ˆä»0å¼€å§‹çš„æ’å - ä»ä½åˆ°é«˜ï¼‰</span>

<span class="token constant">ZREVEANK</span> z1 u4 <span class="token comment">// z1é›†åˆä»é«˜åˆ°ä½çš„æ’å</span>

<span class="token constant">ZCARD</span> z1   <span class="token comment">// è·å–z1æˆå‘˜æ•°</span>

zincrby  z1 <span class="token number">3</span> u2   <span class="token comment">// åœ¨åŸæœ‰å€¼çš„åŸºç¡€ä¸Šå¢åŠ æŒ‡å®šçš„å¢é‡(6+3 = 9)</span>

<span class="token constant">ZREM</span> z1 u2    <span class="token comment">// åˆ é™¤æœ‰åºé›†åˆz1ä¸­ çš„ u2å€¼</span>
<span class="token constant">RNAME</span> z1 zz   <span class="token comment">// æŠŠz1 é”®æ”¹ä¸ºzz</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="redis-å¯†ç "><a href="#redis-å¯†ç " class="header-anchor">#</a> Redis å¯†ç </h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·å–å¯†ç ï¼Œé»˜è®¤æ— å¯†</span>
<span class="token constant">CONFIG</span> <span class="token constant">GET</span> requirepass
<span class="token comment">// è®¾ç½®å¯†ç ä¸ºroot</span>
<span class="token constant">CONFIG</span> <span class="token constant">SET</span> requirepass root
<span class="token comment">// è®¾ç½®å¯†ç åè¿æ¥redis-cli</span>
redis<span class="token operator">-</span>cli <span class="token operator">-</span>a root
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="redis-config-é…ç½®"><a href="#redis-config-é…ç½®" class="header-anchor">#</a> Redis config é…ç½®</h3> <blockquote><p>redis é»˜è®¤ä¸ºå®‰å…¨æ¨¡å¼ï¼Œéœ€è¦å…ˆæ·»åŠ å¯†ç ï¼Œç„¶åå…è®¸å®¢æˆ·ç«¯è¿æ¥redis</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// 1. è¿æ¥redis-cli è¾“å…¥å‘½ä»¤æŸ¥çœ‹redis.config å®‰è£…ç›®å½•</span>
  info server
  
<span class="token comment">// 2. vim æ‰“å¼€configç›®å½• </span>
  vim <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
  
<span class="token comment">// 3. è¾“å…¥ /bind æœç´¢ åˆ°bind 127.0.0.1 ::1 åœ¨ä¸‹é¢æ·»åŠ ä¸€è¡Œå…è®¸å®¢æˆ·ç«¯è¿æ¥redis</span>
bind <span class="token operator">*</span>

<span class="token comment">// 4. ç»™redisæ·»åŠ å¯†ç  æœç´¢requirepassï¼Œåœ¨ä¸‹é¢æ·»åŠ ä¸€è¡Œ</span>
 requirepass root
 
<span class="token comment">// 5. å†™å…¥å¹¶é€€å‡º</span>
    <span class="token operator">:</span>wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="ä½¿ç”¨nodeæ“ä½œredis"><a href="#ä½¿ç”¨nodeæ“ä½œredis" class="header-anchor">#</a> ä½¿ç”¨Nodeæ“ä½œRedis</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ioredis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token number">6379</span><span class="token punctuation">,</span> <span class="token string">'192.168.1.2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>password<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'mykey'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
redis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="çƒ­åº¦æ’åæ¡ˆä¾‹"><a href="#çƒ­åº¦æ’åæ¡ˆä¾‹" class="header-anchor">#</a> çƒ­åº¦æ’åæ¡ˆä¾‹</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ioredis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token number">6379</span><span class="token punctuation">,</span> <span class="token string">'192.168.1.2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>password<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> num <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'asdfghjklqw'</span> 
<span class="token keyword">let</span> strindex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">11</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> collection_name <span class="token operator">=</span> <span class="token string">'hots'</span>
<span class="token keyword">const</span> <span class="token function-variable function">hots</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æŸ¥çœ‹å½“å‰çš„æœ‰åºé›†åˆ key æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zscore</span><span class="token punctuation">(</span>collection_name<span class="token punctuation">,</span> str<span class="token punctuation">[</span>strindex<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å­˜åœ¨ è®©keyçš„å€¼åŠ 1</span>
        <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span>collection_name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> str<span class="token punctuation">[</span>strindex<span class="token punctuation">]</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>strindex<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'+ 1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">// ä¸å­˜åœ¨  æ·»åŠ åˆ°æœ‰åºé›†åˆ</span>
        <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span>collection_name<span class="token punctuation">,</span> num<span class="token punctuation">,</span>  str<span class="token punctuation">[</span>strindex<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">// ä»é«˜åˆ°ä½æ’åºï¼Œå¹¶æ˜¾ç¤ºå€¼</span>
  <span class="token keyword">const</span> paixu <span class="token operator">=</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span>collection_name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'withscores'</span><span class="token punctuation">)</span>
    <span class="token comment">// ç»„åˆä¸ºkey valueå½¢å¼</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paixu<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            obj<span class="token punctuation">[</span>paixu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> paixu<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">hots</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="ç›¸å…³åœ°å€"><a href="#ç›¸å…³åœ°å€" class="header-anchor">#</a> ç›¸å…³åœ°å€</h3> <p>https://redis.io/docs/clients/#nodejs
https://github.com/luin/ioredis
https://redis.io/docs/getting-started/installation/install-redis-on-linux/</p> <h2 id="è§†é¢‘æ”¶è—åŠŸèƒ½å®ç°"><a href="#è§†é¢‘æ”¶è—åŠŸèƒ½å®ç°" class="header-anchor">#</a> è§†é¢‘æ”¶è—åŠŸèƒ½å®ç°</h2> <ul><li>æ–°å»ºmodel collectionModel.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> videoCollectSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// å…³è”users é›†åˆ</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    video<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// å…³è” videos é›†åˆ</span>
        ref<span class="token operator">:</span> <span class="token string">'Video'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>baseModel
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> videoCollectSchema
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>è§†é¢‘æ”¶è—å®ç° videoController.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">collect</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> video_id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>video_id
    <span class="token keyword">const</span> user_id <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token comment">// 1. åˆ¤æ–­è§†é¢‘æ˜¯å¦å­˜åœ¨</span>
   <span class="token keyword">const</span> dbvideo <span class="token operator">=</span> <span class="token keyword">await</span> Video<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>video_id<span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dbvideo<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'è§†é¢‘ä¸å­˜åœ¨'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// 2. è§†é¢‘æ˜¯å¦å·²æ”¶è—</span>
  <span class="token keyword">const</span> iscollect <span class="token operator">=</span> <span class="token keyword">await</span> Collect<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    video<span class="token operator">:</span> video_id<span class="token punctuation">,</span>
    user<span class="token operator">:</span> user_id
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>iscollect<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'error'</span><span class="token operator">:</span> <span class="token string">'è§†é¢‘å·²æ”¶è—'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// 3. æœªæ”¶è—</span>
   <span class="token keyword">const</span> collect <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Collect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    video<span class="token operator">:</span> video_id<span class="token punctuation">,</span>
    user<span class="token operator">:</span> user_id
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token function">redisVideoHots</span><span class="token punctuation">(</span>video_id<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
   res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="å®ç°è§†é¢‘çƒ­é—¨æ¨èæœºåˆ¶"><a href="#å®ç°è§†é¢‘çƒ­é—¨æ¨èæœºåˆ¶" class="header-anchor">#</a> å®ç°è§†é¢‘çƒ­é—¨æ¨èæœºåˆ¶</h2> <ul><li>è¿æ¥redis  model/reids/index.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ioredis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token number">6379</span><span class="token punctuation">,</span> <span class="token string">'192.168.1.2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>password<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

redis<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'redisè¿æ¥é”™è¯¯'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
redis<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'redis è¿æ¥æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>redis <span class="token operator">=</span> redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>redis æ·»åŠ è§†é¢‘çƒ­åº¦åŠè·å–è§†é¢‘çƒ­åº¦</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>redis<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./index'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> redis_hots_name <span class="token operator">=</span> <span class="token string">'hotsname'</span>
<span class="token comment">/**
 * 
 * @param {*} videoid è§†é¢‘id
 * @param {*} num çƒ­åº¦å€¼
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">redisVideoHots</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">videoid<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zscore</span><span class="token punctuation">(</span>redis_hots_name<span class="token punctuation">,</span> videoid<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> hots <span class="token operator">=</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span>redis_hots_name<span class="token punctuation">,</span> num<span class="token punctuation">,</span> videoid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> hots <span class="token operator">=</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span>redis_hots_name<span class="token punctuation">,</span> num<span class="token punctuation">,</span> videoid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> hots
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 
 * @param {*} num è·å–æ¡æ•°
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">getRedisVideoHots</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hots <span class="token operator">=</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span>redis_hots_name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'withscores'</span><span class="token punctuation">)</span>
    <span class="token comment">// redis é”® å€¼æ˜¯åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥éœ€è¦ * 2</span>
    <span class="token keyword">const</span> video_hots <span class="token operator">=</span> hots<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> video_hots<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// [f,1,g,0,k,8] å¶æ•°ä¸‹æ ‡ä¸ºé”® å¥‡æ•°ä¸‹æ ‡ä¸ºå€¼</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            obj<span class="token punctuation">[</span>video_hots<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> video_hots<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li>å®šä¹‰çƒ­åº¦æƒé‡ï¼Œè®¾ç½®è§†é¢‘çƒ­åº¦å€¼</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è§‚çœ‹ +1 ç‚¹èµ +2 è¯„è®º +2 æ”¶è— +3</span>
 <span class="token function">redisVideoHots</span><span class="token punctuation">(</span>video_id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>è·å–çƒ­åº¦å€¼</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">getVideoHots</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> num <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>num
    <span class="token keyword">const</span> hotlist <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getRedisVideoHots</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>hotlist<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="unbantu"><a href="#unbantu" class="header-anchor">#</a> unbantu</h2> <h3 id="å®‰è£…node"><a href="#å®‰è£…node" class="header-anchor">#</a> å®‰è£…node</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>curl <span class="token operator">-</span>fsSL https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>deb<span class="token punctuation">.</span>nodesource<span class="token punctuation">.</span>com<span class="token operator">/</span>setup_16<span class="token punctuation">.</span>x <span class="token operator">|</span> sudo <span class="token operator">-</span><span class="token constant">E</span> bash <span class="token operator">-</span> <span class="token operator">&amp;&amp;</span>\
sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y nodejs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="nginx-åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡"><a href="#nginx-åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡" class="header-anchor">#</a> nginx åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</h2> <blockquote><p>nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„httpæœåŠ¡çš„è½¯ä»¶ï¼Œå…·æœ‰éå¸¸å¥½çš„é«˜å¹¶å‘çš„å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿæ”¯æŒåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</p></blockquote> <h3 id="nginx-å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨"><a href="#nginx-å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨" class="header-anchor">#</a> nginx å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨</h3> <h4 id="å®‰è£…-5"><a href="#å®‰è£…-5" class="header-anchor">#</a> å®‰è£…</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install nginx
<span class="token comment">// å¯æ‰§è¡Œçš„nginx æ”¾åœ¨</span>
cd <span class="token operator">/</span>usr<span class="token operator">/</span>share

<span class="token comment">// nginx.conf é…ç½®æ–‡ä»¶åœ¨</span>
cd <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>

<span class="token comment">// nginxæ—¥å¿—æ–‡ä»¶</span>
cd <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>nginx

<span class="token comment">// access.log  nginx æ¥æ”¶åˆ°çš„è¯·æ±‚æ—¥å¿—</span>
<span class="token comment">// error.log   nginx æ¥æ”¶åˆ°çš„é”™è¯¯æ—¥å¿—</span>

<span class="token comment">// æŸ¥çœ‹ nginx å ç”¨ç«¯å£</span>
sudo netstat <span class="token operator">-</span>tupln <span class="token operator">|</span> grep <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="nginx-å·¥ä½œæ¨¡å‹"><a href="#nginx-å·¥ä½œæ¨¡å‹" class="header-anchor">#</a> nginx å·¥ä½œæ¨¡å‹</h3> <figure class="third"><img src="/blog/img/node/nginx_mode.jpg" width="400px"></figure> <ul><li>master ä¸»è¿›ç¨‹ åªè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ï¼Œè‡ªèº«ä¸å¤„ç†ï¼Œä¹‹ååˆ†é…ç»™å­è¿›ç¨‹ï¼Œå¦‚æœå½“å‰å­è¿›ç¨‹å·¥ä½œé¥±å’Œï¼Œä¼šå†å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™æ ·å¯ä»¥åº”å¯¹å¹¶å‘é‡</li></ul> <h3 id="nginx-å‘½ä»¤"><a href="#nginx-å‘½ä»¤" class="header-anchor">#</a> nginx å‘½ä»¤</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åœæ­¢</span>
nginx <span class="token operator">-</span>s stop
<span class="token comment">// å¼€å¯</span>
nginx

<span class="token comment">// åœæ­¢</span>
nginx <span class="token operator">-</span>s quit

<span class="token operator">!</span> quit ä¸ stop çš„åŒºåˆ«
quitï¼šä¼˜é›…åœæ­¢ æ‰€æœ‰å­è¿›ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šé”€æ¯è¿›ç¨‹ï¼Œåœæ­¢æœåŠ¡ï¼Œå¦‚æœå†æœ‰è¯·æ±‚è¿›æ¥ä¹Ÿä¸ä¼šæ¥æ”¶
stopï¼šç«‹å³åœæ­¢ æ— è®ºä»€ä¹ˆæƒ…å†µï¼Œç›´æ¥åœæ­¢æœåŠ¡
å»ºè®®ä½¿ç”¨quit

<span class="token comment">// é‡æ–°è®°å½•æ—¥å¿—ä½ç½®ï¼ˆå½“ä¿®æ”¹æ—¥å¿—æ–‡ä»¶å¤¹åå­—åæ—¥å¿—è¿˜ä¼šè®°å½•åœ¨åŸå…ˆçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå› ä¸ºnginxåœ¨æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œä¸æ˜¯æŒ‰ç…§æ–‡ä»¶å¤¹åæ‰¾çš„ï¼Œè€Œæ˜¯æŒ‰ç…§æ–‡ä»¶çš„ä½ç½®ï¼Œç±»ä¼¼äºjsä¸­çš„å¼•ç”¨ç±»å‹ï¼‰</span>
nginx <span class="token operator">-</span>s reopen

<span class="token comment">// éªŒè¯é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§</span>
nginx <span class="token operator">-</span>t

<span class="token comment">// æ”¹å˜é…ç½®æ–‡ä»¶åä¸å¸Œæœ›æœåŠ¡ç«‹åˆ»åœæ­¢ï¼Œè€Œæ˜¯æ–°çš„è¯·æ±‚è¿›æ¥åå†è¯·æ±‚æ–°çš„é…ç½®æ–‡ä»¶</span>
nginx <span class="token operator">-</span>s reload

<span class="token comment">// æŸ¥çœ‹ nginx æŒ‡ä»¤</span>
nginx <span class="token operator">-</span>h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="nginx-é…ç½®æ–‡ä»¶"><a href="#nginx-é…ç½®æ–‡ä»¶" class="header-anchor">#</a> nginx é…ç½®æ–‡ä»¶</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Main  <span class="token comment">// å…¨å±€é…ç½®åŒºï¼ŒNginx æ ¸å¿ƒåŠŸèƒ½é…ç½®</span>

<span class="token comment">// Main åŒºåŸŸ</span>
user www<span class="token operator">-</span>data<span class="token punctuation">;</span> åœ¨å¯åŠ¨nginxæ—¶ï¼Œä»–æ˜¯ç”¨å“ªä¸€ä¸ªç³»ç»Ÿä¸‹çš„è´¦æˆ·å¯åŠ¨çš„

worker_processes auto  å…è®¸å¼€å¯çš„workeræ•°é‡ auto æ ¹æ®æ“ä½œç³»ç»Ÿé…ç½®ï¼Œé€šå¸¸ä¼šè®¾ç½®æˆcpuçš„æ•°é‡ç›¸ç­‰

pid <span class="token operator">/</span>run<span class="token operator">/</span>nginx<span class="token punctuation">.</span>pid  æ¯ä¸€ä¸ªnginx å¯åŠ¨éƒ½ä¼šå ç”¨ä¸€ä¸ªpid

include å¼•å…¥é…ç½®æ–‡ä»¶

events<span class="token punctuation">{</span> <span class="token comment">// events äº‹ä»¶åŒº å­è¿›ç¨‹æ ¸å¿ƒé…ç½®</span>
    worker_connections <span class="token number">768</span><span class="token punctuation">;</span> <span class="token comment">// æ¯ä¸€ä¸ªworkeræ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ï¼Œæ¯ä¸€ä¸ªworker æœ€å¤§å¯ä»¥æ‰“å¼€768ä¸ªé“¾æ¥ï¼Œä¹Ÿå°±æ˜¯å¤„ç†768ä¸ªå¹¶å‘æ•°ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ¯ä¸€ä¸ªworkerå­è¿›ç¨‹å¯ä»¥å¤„ç†768ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œç†è®ºæœ€å¤§æ”¯æŒ65535ï¼Œä¹Ÿå°±æ˜¯2çš„16æ¬¡æ–¹å‡ä¸€</span>
<span class="token punctuation">}</span> 

http <span class="token punctuation">{</span> <span class="token comment">// http  æœåŠ¡å™¨é…ç½®åŒº</span>
    
    sendfile on<span class="token punctuation">;</span> <span class="token comment">// è¦ä¸è¦è®©nginxå»è°ƒç”¨ç³»ç»Ÿçš„sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶</span>
    
    tcp_nopush on<span class="token punctuation">;</span>
    tcp_nodelay on<span class="token punctuation">;</span> è¿™ä¸ªå’Œä¸Šä¸€ä¸ªéœ€è¦é…åˆä½¿ç”¨ï¼Œnginxåœ¨å¤„ç†é“¾æ¥çš„æ—¶å€™ï¼Œå¤„ç†çš„æ•°æ®åŒ…ä¼šä¸ä¼šç´¯è®¡ï¼Œå¦‚æœæ˜¯onåˆ™ä¼šç´¯ç§¯ä¸€èµ·ä¼ è¾“ï¼Œæé«˜ä¼ è¾“æ•ˆç‡<span class="token punctuation">,</span>åä¸€ä¸ªçš„å«ä¹‰æ˜¯ æœ€å°æ•°æ®åŒ…æ˜¯å¦ç­‰å¾…
    
 keepalive_timeout <span class="token number">65</span>  <span class="token comment">// ä¸€ä¸ªäº¤äº’æœ€é•¿çš„æ–­å¼€æ—¶é—´ï¼Œå¦‚æœ65sä¹‹å†…æœ‰è¯·æ±‚ï¼Œé“¾æ¥åˆ™ä¿æŒ</span>
 
 include <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>mime<span class="token punctuation">.</span>typesï¼›
 dfault_type application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span> <span class="token comment">// å¦‚æœåœ¨mime.typesæ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç»Ÿä¸€ä½¿ç”¨application/octet-streamäºŒè¿›åˆ¶æµçš„å½¢å¼åšè¿”å›</span>
 
 <span class="token comment">// nginxæ—¥å¿—æ–‡ä»¶ nginx -s reload é‡æ–°è®°å½•æ—¥å¿—æ–‡ä»¶</span>
 access_log <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log
 error_log <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log 
   
   gzip on<span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤å¼€å¯ gzip</span>
   
   include <span class="token operator">/</span>ect<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token comment">/*.cond;
   include /ect/nginx/sites-enabled/*;
   // sites-enabled/default ä¸­
   server {
    listen 80 default_server; //nginx é»˜è®¤å¯åŠ¨ 80ç«¯å£
    root /var/www/html; nginxå¯åŠ¨åæ¥åˆ°è¯·æ±‚ï¼Œworkerå¤„ç†æ—¶ï¼Œnginxè¿”å›ç»™å®¢æˆ·ç«¯çš„è·¯å¾„æ–‡ä»¶åœ°å€
    
    index index.html index.htm index.nginx-cebian.html //æ‰¾/var/www/htmlæ–‡ä»¶å¤¹ä¸‹çš„index æ–‡ä»¶ï¼Œä¼˜å…ˆé€‰æ‹©.html
    location /{ // location è¯·æ±‚è·¯å¾„é…ç½® æ–œæ / è¯·æ±‚çš„è·¯å¾„ä¸ºæ ¹è·¯å¾„
     proxy_pass http://127.0.0.1:3000; // åå‘ä»£ç† ä»£ç†åˆ°3000ç«¯å£
    
    }
   }
    ---------------------------------
    server { // ä¸åŒæœåŠ¡é…ç½®åŒº
        location { // location ä¸åŒè¯·æ±‚è·¯å¾„é…ç½®åŒº
            // å…·ä½“é…ç½®é¡¹
        }
    }
}

mail { // é‚®ä»¶ä»£ç†é…ç½®åŒº
    server { // é‚®ä»¶æœåŠ¡é…ç½®åŒº
        // å…·ä½“é…ç½®é¡¹
    }
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="nginx-åå‘ä»£ç†"><a href="#nginx-åå‘ä»£ç†" class="header-anchor">#</a> nginx åå‘ä»£ç†</h3> <figure class="third"><img src="/blog/img/node/nginx_proxy.jpg" width="400px"></figure> <ul><li>å¤–éƒ¨å®¢æˆ·ç«¯ é€šè¿‡ç½‘å…³è®¿é—®å†…ç½‘æœåŠ¡å™¨çš„å†…å®¹ï¼Œç½‘å…³èµ·åˆ°äº†åå‘ä»£ç†çš„ä½œç”¨ï¼Œå†…ç½‘æœåŠ¡å™¨ä¸æä¾›å¯¹å¤–æœåŠ¡ï¼Œå®¢æˆ·ç«¯ç›´æ¥è®¿é—®å†…ç½‘æœåŠ¡å™¨æ˜¯ä¸å…è®¸çš„ï¼Œnginxç›¸å½“äºç½‘å…³çš„ä½œç”¨ï¼Œnginxå»ä»£ç†è¿™äº›æœåŠ¡å™¨</li></ul> <h2 id="https-é…ç½®"><a href="#https-é…ç½®" class="header-anchor">#</a> https é…ç½®</h2> <p>åœ¨httpçš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªåŠ å¯†å±‚ï¼Œhttpæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œhttpsæ˜¯åœ¨æ˜æ–‡ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®è¿›è¡Œè®¤è¯åŠ å¯†ï¼Œä¿è¯é€šä¿¡å®‰å…¨</p> <ul><li>ç”³è¯·è¯ä¹¦</li> <li>sites-enabled/default ä¸­</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name www<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>com<span class="token punctuation">;</span> 
    ssl_certificate <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>x<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    ssl_certificate_key <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>x<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="é¡¹ç›®å®Œæ•´åœ°å€"><a href="#é¡¹ç›®å®Œæ•´åœ°å€" class="header-anchor">#</a> é¡¹ç›®å®Œæ•´åœ°å€</h2> <p>https://github.com/Dave-SEO/node-express.git</p> <h2 id="è‡ªå®šä¹‰è„šæ‰‹æ¶çš„å®ç°"><a href="#è‡ªå®šä¹‰è„šæ‰‹æ¶çš„å®ç°" class="header-anchor">#</a> è‡ªå®šä¹‰è„šæ‰‹æ¶çš„å®ç°</h2> <h3 id="åˆ›å»ºè‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤"><a href="#åˆ›å»ºè‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤" class="header-anchor">#</a> åˆ›å»ºè‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤</h3> <ul><li>æ ¹ç›®å½•ä¸‹åˆ›å»º bin/cli.js</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// æŒ‡å®šç”¨nodeæ‰§è¡Œè„šæœ¬æ–‡ä»¶</span>
 #<span class="token operator">!</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>npm init</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ›å»ºbin/cli.jsåä¼šè‡ªåŠ¨åœ¨packageæ–‡ä»¶ä¸­ç”Ÿæˆbiné…ç½®</span>
 <span class="token string">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string">&quot;cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/cli.js&quot;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="ä½¿ç”¨commanderå¤„ç†helpé€‰é¡¹åŠè‡ªå®šä¹‰"><a href="#ä½¿ç”¨commanderå¤„ç†helpé€‰é¡¹åŠè‡ªå®šä¹‰" class="header-anchor">#</a> ä½¿ç”¨commanderå¤„ç†helpé€‰é¡¹åŠè‡ªå®šä¹‰</h3> <ul><li>å®‰è£…commander</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// https://www.npmjs.com/package/commander</span>
 npm i commander
 
  <span class="token keyword">const</span> <span class="token punctuation">{</span>program<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>
  program<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-f --framwork &lt;framwork&gt;'</span><span class="token punctuation">,</span> <span class="token string">'è®¾ç½®æ¡†æ¶'</span><span class="token punctuation">)</span>
  program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// å‘½ä»¤è¡Œæ‰§è¡Œ</span>
  mycli <span class="token operator">-</span>f xxx
  mycli <span class="token operator">--</span>help
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>commander è‡ªå®šä¹‰å‘½ä»¤
mycli create xxx</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   <span class="token keyword">const</span> <span class="token punctuation">{</span>program<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>
   program<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'create &lt;project&gt; [other...]'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">'crt'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'åˆ›å»ºé¡¹ç›®'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">project<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¥æ”¶xxxæ–‡ä»¶å</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>project<span class="token punctuation">)</span>
    <span class="token comment">// æ¥æ”¶å‚æ•°</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>npm åœ°å€
https://github.com/tj/commander.js</li></ul> <h3 id="å‘½ä»¤è¡Œé—®ç­”äº¤äº’-inquirer-js"><a href="#å‘½ä»¤è¡Œé—®ç­”äº¤äº’-inquirer-js" class="header-anchor">#</a> å‘½ä»¤è¡Œé—®ç­”äº¤äº’(inquirer.js)</h3> <ul><li>å®‰è£… inquirer</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   npm install <span class="token operator">--</span>save inquirer@<span class="token operator">^</span><span class="token number">8.0</span><span class="token number">.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>ä½¿ç”¨</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
       <span class="token punctuation">{</span>
           type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
           name<span class="token operator">:</span> <span class="token string">'framwork'</span><span class="token punctuation">,</span>
           choices<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'express'</span><span class="token punctuation">,</span> <span class="token string">'koa'</span><span class="token punctuation">,</span> <span class="token string">'egg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           message<span class="token operator">:</span> <span class="token string">'è¯·é€‰æ‹©ä½ è¦ä½¿ç”¨çš„æ¡†æ¶'</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>answers<span class="token punctuation">)</span>
       <span class="token comment">// Use user feedback for... whatever!!</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>isTtyError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// Prompt couldn't be rendered in the current environment</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token comment">// Something else went wrong</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>npm åœ°å€
https://www.npmjs.com/package/inquirer</li></ul> <h3 id="ä¸‹è½½è¿œç¨‹ä»“åº“æ¨¡ç‰ˆä»£ç -download-git-repo"><a href="#ä¸‹è½½è¿œç¨‹ä»“åº“æ¨¡ç‰ˆä»£ç -download-git-repo" class="header-anchor">#</a> ä¸‹è½½è¿œç¨‹ä»“åº“æ¨¡ç‰ˆä»£ç (download-git-repo)</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   <span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span>
   <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'giteeåœ°å€'</span>
   <span class="token keyword">const</span> dir <span class="token operator">=</span> <span class="token string">'xxx'</span>
   <span class="token function">download</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">direct:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> dir<span class="token punctuation">,</span> <span class="token punctuation">{</span> clone<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>npm åœ°å€
https://www.npmjs.com/package/download-git-repo</li></ul> <h3 id="ä¸‹è½½ç­‰å¾…æç¤ºäº¤äº’-ora"><a href="#ä¸‹è½½ç­‰å¾…æç¤ºäº¤äº’-ora" class="header-anchor">#</a> ä¸‹è½½ç­‰å¾…æç¤ºäº¤äº’(ora)</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   <span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
   <span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   spinner<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
   spinner<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'ä¸‹è½½ä¸­...'</span><span class="token punctuation">;</span>
   spinner<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'ä¸‹è½½å®Œæˆ'</span><span class="token punctuation">)</span>
   spinner<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'ä¸‹è½½å¤±è´¥'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>npmåœ°å€
https://www.npmjs.com/package/ora</li></ul> <h3 id="å‘½ä»¤è¡Œæ ·å¼æ¸²æŸ“å·¥å…·-chalk"><a href="#å‘½ä»¤è¡Œæ ·å¼æ¸²æŸ“å·¥å…·-chalk" class="header-anchor">#</a> å‘½ä»¤è¡Œæ ·å¼æ¸²æŸ“å·¥å…·(chalk)</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token comment">// ç²—ä½“ç»¿è‰²</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span>bold<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">'npm install'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>npm åœ°å€
https://www.npmjs.com/package/chalk</li></ul> <h3 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="header-anchor">#</a> é¡¹ç›®åœ°å€</h3> <p>https://github.com/Dave-SEO/mycli.git</p> <h2 id="å°†è‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·å‘å¸ƒåˆ°npm"><a href="#å°†è‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·å‘å¸ƒåˆ°npm" class="header-anchor">#</a> å°†è‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·å‘å¸ƒåˆ°npm</h2> <p>å‘å¸ƒé•œåƒæºnpmåœ°å€å¿…é¡»æ˜¯npmå®˜ç½‘</p> <ul><li>ä»¥jsonæ ¼å¼å±•ç¤ºé…ç½®æ–‡ä»¶åˆ—è¡¨</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>npm config list <span class="token operator">-</span>l <span class="token operator">--</span>json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>è®¾ç½®é•œåƒæº</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> npm config <span class="token keyword">set</span> registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npmjs<span class="token punctuation">.</span>org
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>ç™»é™†</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>npm login
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// æœ€åä¸€ä½è‡ªåŠ¨åŠ ä¸€</span>
    npm version patch
    <span class="token comment">// ä¸­é—´ä¸€ä½è‡ªåŠ¨åŠ ä¸€</span>
    npm version minor
    <span class="token comment">// ç¬¬ä¸€ä½åŠ ä¸€</span>
    npm version major
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>å‘å¸ƒ åŒ…åä¸èƒ½æ˜¯å·²ç»å­˜åœ¨çš„åå­—(åœ¨npmä¸Š)</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>npm publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>ä½¿ç”¨  å…¨å±€å®‰è£…å‘å¸ƒåçš„è„šæ‰‹æ¶</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>npm install <span class="token operator">-</span>g xxx
xxx <span class="token operator">-</span>h <span class="token comment">// å¸®åŠ©å‘½ä»¤</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/Dave-SEO/blog/edit/master/docs/views/nodejs/nodejsä»0åˆ°1.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µï¼</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> <!----> <div class="article-list" data-v-2af88190><div class="article-title" data-v-2af88190><a href="/blog/timeline/" class="iconfont icon-shizhong" data-v-2af88190>æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper" data-v-2af88190><dl data-v-2af88190><dd data-v-2af88190>01</dd> <dt data-v-2af88190><a href="/blog/views/mianshi/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95.html" data-v-2af88190><div data-v-2af88190>å‰ç«¯é¢è¯•(ä¸€)</div></a> <span data-v-2af88190>03-30</span></dt></dl><dl data-v-2af88190><dd data-v-2af88190>02</dd> <dt data-v-2af88190><a href="/blog/views/JavaScript/JavaScript%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1.html" data-v-2af88190><div data-v-2af88190>JavaScript çŸ¥è¯†å›¾è°±</div></a> <span data-v-2af88190>03-11</span></dt></dl><dl data-v-2af88190><dd data-v-2af88190>03</dd> <dt data-v-2af88190><a href="/blog/views/react/React+TypeScript+AntDesign.html" data-v-2af88190><div data-v-2af88190>ä½¿ç”¨React + TypeScript + Ant Design ç¬”è®°</div></a> <span data-v-2af88190>03-05</span></dt></dl></div> <div data-v-2af88190><a href="/blog/timeline/" class="article-more" data-v-2af88190>æ›´å¤šæ–‡ç«  &gt;</a></div></div></main> <!----> <div class="comments-wrapper" style="display:none;" data-v-584a622c><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-566b5166 data-v-566b5166><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-566b5166><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-566b5166></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-566b5166></path></svg></div><!----><div data-v-48108b4c><div class="DetailsOpenFlag" style="right:1rem;bottom:9rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;font-size:14px;font-weight:500;display:none;" data-v-48108b4c>
 å±•å¼€ 

</div></div><div id="musicPlayer" data-v-647473e2><!----> <div class="bbox" data-v-647473e2><div class="pan" style="background-image:url(/blog/assets/img/pan.07613e22.png);" data-v-647473e2><img src="" alt class="pan_c" data-v-647473e2></div> <div class="box" style="background-image:url();" data-v-647473e2><div class="music_shlter_2" style="background-image:url();" data-v-647473e2></div> <div class="music_shlter" style="background-image:url();" data-v-647473e2></div> <div class="music_shlter_3" data-v-647473e2></div> <div class="music_dis" data-v-647473e2><div class="dis_list" data-v-647473e2>Â·Â·Â·</div> <p class="music_title" data-v-647473e2></p> <p class="music_intro" data-v-647473e2>æ­Œæ‰‹: </p> <ul class="music_words" data-v-647473e2><div class="music_words_box" style="top:0px;" data-v-647473e2></div></ul></div> <div class="control_box" data-v-647473e2><div class="control_button" data-v-647473e2><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAACMCAYAAACksC0pAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALjSURBVHhe7doxbuswFETRSG68pVTZ+y+SJdmVE/GDC0hzBxnynoqpBGhIaoy84/vyBnu9Xv9ut9vH/HN5j8fj836/v88/Mc/n8+uca9RxHPgm2VUkwN2kNux4TiTA65Y+5nIL53m+5hI1nuMJLGeAgKu0xW42AwQEiv1/10bJBLhhC0198z2BBFtoueUC3I0BlkvdOLZQyGiHc4myhXJsoc2CG9YWSkgFeJ6nJYZgCy1nCy23XIC7tVBPYL/YhjVAwGiHc4mK/Uc+daX8FbZQ/YrfQEhqpGIwQEDqkzE2SiTA3X5GJHkCAcuVmN1aqIO95ZIb1gABqQD9GQG5XuxcsRyp4KSuUE8gwRZabrkAd2OA5Wyh5Rzs7WcLbRbcsLZQQipAB3shttByttByywW4Wwv1BPaLbVgDBDjYW84WWs5vYLnkjWOAgFSADvYuwBMISG1YWyhkvNi5RNlCIZaYcqkAx3MMEHC92LliOVLBSV2hnkBCasPGSowtlGELLWeAEFtoOQd7+9lCmwU3rC2UkApwjG54AgGpAG2hEFtoueUC3K2FegL7xTasAQJGO5xLlCMVEFtoOb+B5ZI3jgECUgE62LsATyAgtWFtoRBHKspZYsqlAhzPMUDA9WLniuVIBSd1hXoCCakNGysxtlCGLbScAUJsoeUc7O1nC20W3LC2UEIqwDG64QkEpAK0hUJsoeWWC3C3FuoJ7BfbsAYIGO1wLlGOVEBsoeX8BpZL3jgGCEgF6GDvAjyBgOVKzG4tNDVSEfsZsRtLTLlUgOM5Bgi4XuxcsRyp4KSuUE8gwRZabrkAd2OA5Wyh5Rzs7WcLbRbcsLZQQipAB3shttByttByywW4Wwv1BPaLbVgDBDjYW84Wql/xGwgZ85pziTNAQOqT4WDvAjyBgOVKzG4t1MHecskNa4CAVID+jIBcL3auWI5UcFJXqCeQYAstt1yAuzHAcrbQcg729rOFNstt2LfvHxY+GuRFc4rhAAAAAElFTkSuQmCC" alt class="control_icon" data-v-647473e2></div> <div class="progress" data-v-647473e2><div class="progress_c" style="width:0%;" data-v-647473e2><div class="progress_circle" data-v-647473e2><div class="progress_circle_c" data-v-647473e2></div></div></div></div></div></div> <video id="music" autoplay="autoplay" src="" name="media" data-v-647473e2></video></div></div></div></div>
    <script src="/blog/assets/js/app.45508e95.js" defer></script><script src="/blog/assets/js/5.e2f1812c.js" defer></script><script src="/blog/assets/js/1.f0d29b0d.js" defer></script><script src="/blog/assets/js/2.c2276c40.js" defer></script><script src="/blog/assets/js/70.2b8dc1d3.js" defer></script><script src="/blog/assets/js/20.fc7d5e78.js" defer></script>
  </body>
</html>
